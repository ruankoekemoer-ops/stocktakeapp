#!/usr/bin/env node
/**
 * Script to embed static files into static-files.js
 * This allows the Worker to serve the frontend
 */

const fs = require('fs');
const path = require('path');

const baseDir = path.join(__dirname, '..');
const stockTakeAppDir = path.join(baseDir, 'stock-take-app');

// Read files
const indexHtml = fs.readFileSync(path.join(stockTakeAppDir, 'index.html'), 'utf8');
const appJs = fs.readFileSync(path.join(stockTakeAppDir, 'js', 'app.js'), 'utf8');
const styleCss = fs.readFileSync(path.join(stockTakeAppDir, 'css', 'style.css'), 'utf8');

// Update HTML to use absolute paths
const indexHtmlFixed = indexHtml
  .replace('href="css/style.css"', 'href="/css/style.css"')
  .replace('src="js/config.js"', 'src="/js/config.js"')
  .replace('src="js/app.js"', 'src="/js/app.js"');

// Generate config.js that uses same domain
const configJs = `/**
 * Configuration
 * Uses same domain as frontend - no CORS issues!
 */

const CONFIG = {
    // API server URL - Same domain as frontend
    apiUrl: window.location.origin + '/api',
};

// Make available globally
window.CONFIG = CONFIG;`;

// Generate static-files.js
const staticFilesContent = `/**
 * Static file content for the frontend
 * Auto-generated by build-static-files.js
 * DO NOT EDIT MANUALLY - Run: node build-static-files.js
 */

export const indexHtml = ${JSON.stringify(indexHtmlFixed)};

export const configJs = ${JSON.stringify(configJs)};

export const appJs = ${JSON.stringify(appJs)};

export const styleCss = ${JSON.stringify(styleCss)};
`;

// Write to file
fs.writeFileSync(
  path.join(__dirname, 'src', 'static-files.js'),
  staticFilesContent,
  'utf8'
);

console.log('âœ… Static files embedded successfully!');
console.log('   Run: npm run deploy');

