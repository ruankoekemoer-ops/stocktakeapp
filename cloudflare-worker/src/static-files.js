/**
 * Static file content for the frontend
 * Auto-generated by build-static-files.js
 * DO NOT EDIT MANUALLY - Run: node build-static-files.js
 */

export const indexHtml = "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Stock Take Management System</title>\n    <link rel=\"stylesheet\" href=\"/css/style.css\">\n    <script src=\"https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js\"></script>\n    <!-- Microsoft Authentication Library (MSAL.js) -->\n    <script src=\"https://alcdn.msauth.net/browser/2.38.1/js/msal-browser.min.js\"></script>\n</head>\n<body>\n    <!-- Toast Notification Container -->\n    <div id=\"toastContainer\" class=\"toast-container\"></div>\n    \n    <!-- Role Selection Screen (shown first) -->\n    <div id=\"roleSelectionScreen\" class=\"role-selection-screen\">\n        <div class=\"role-selection-card\">\n            <h1>Stock Take Management System</h1>\n            <p class=\"subtitle\">Select your role to continue</p>\n            <div class=\"role-options\">\n                <button type=\"button\" class=\"role-option-btn counter-btn\" id=\"counterBtn\">\n                    <div class=\"role-icon\">üì±</div>\n                    <h2>Counter</h2>\n                    <p>Scan and count inventory items</p>\n                </button>\n                <button type=\"button\" class=\"role-option-btn manager-btn\" id=\"managerBtn\">\n                    <div class=\"role-icon\">‚öôÔ∏è</div>\n                    <h2>Manager</h2>\n                    <p>Manage companies, warehouses, and view reports</p>\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <!-- Main App (hidden until role selected) -->\n    <div id=\"mainApp\" class=\"app-container\" style=\"display: none;\">\n        <!-- Sidebar Navigation -->\n        <aside class=\"sidebar\" id=\"sidebar\">\n            <div class=\"sidebar-header\">\n                <div class=\"sidebar-logo\">StockTake</div>\n            </div>\n            <nav class=\"sidebar-nav\" id=\"sidebarNav\">\n                <!-- Navigation items will be populated by JavaScript -->\n            </nav>\n        </aside>\n\n        <!-- Main Content Area -->\n        <div class=\"main-content\">\n            <!-- App Header -->\n            <header class=\"app-header\" id=\"appHeader\">\n                <div class=\"header-title\" id=\"pageTitle\">Stock Take</div>\n                <div class=\"header-actions\" id=\"headerActions\">\n                    <div id=\"userInfo\" class=\"user-info\" style=\"display: none;\"></div>\n                    <button id=\"authButton\" class=\"btn btn-primary btn-small\">Sign In</button>\n                    <span class=\"role-badge\" id=\"roleBadge\">Manager</span>\n                    <button onclick=\"switchRole()\" class=\"btn-switch-role\">Switch Role</button>\n                </div>\n            </header>\n\n            <!-- Content Area -->\n            <div class=\"content-area\">\n                <div class=\"page-content\">\n                    <!-- Stock Take Tab -->\n                    <div id=\"stocktakeTab\" class=\"tab-content active\" style=\"display: block;\">\n                        <div class=\"page-header\">\n                            <h1 class=\"page-title\">Stock Take</h1>\n                            <p class=\"page-subtitle\" id=\"roleSubtitle\">Manage companies, warehouses, and view reports</p>\n                        </div>\n\n                        <!-- Counter Mode: Simple Start Counting -->\n                        <section class=\"card\" id=\"counterStartSection\" style=\"display: none;\">\n                            <div class=\"card-header\">\n                                <h2 class=\"card-title\">Start Counting</h2>\n                            </div>\n                            <div class=\"start-counting-container\">\n                                <p class=\"start-hint\">Scan a bin location to begin counting</p>\n                                <div class=\"scan-input-large\">\n                                    <label for=\"counterBinLocationInput\" class=\"scan-label\">Bin Location Code</label>\n                                    <p class=\"scan-hint\">Scan QR code or enter bin code</p>\n                                    <div class=\"input-with-button-large\">\n                                        <input \n                                            type=\"text\" \n                                            id=\"counterBinLocationInput\" \n                                            class=\"form-control scan-input\" \n                                            placeholder=\"Scan or enter bin code to start...\"\n                                            onkeypress=\"if(event.key==='Enter') handleCounterBinLocationScan()\"\n                                            autocomplete=\"off\"\n                                            autofocus\n                                        >\n                                        <button onclick=\"startQRScan('counterBinLocationInput', handleCounterBinLocationScan)\" class=\"btn btn-secondary btn-large\" title=\"Scan QR Code\">üì∑</button>\n                                        <button onclick=\"handleCounterBinLocationScan()\" class=\"btn btn-primary btn-large\">Start</button>\n                                    </div>\n                                </div>\n                            </div>\n                        </section>\n\n                        <!-- Manager Mode: Open/Close Stock Take -->\n                        <section class=\"card\" id=\"managerStockTakeSection\">\n                            <div class=\"card-header\">\n                                <h2 class=\"card-title\">Manage Stock Take</h2>\n                            </div>\n                            <div id=\"stockTakeStatus\" class=\"status-box\">\n                                <p>No stock take open</p>\n                            </div>\n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label for=\"openStockTakeCompany\">Company</label>\n                                    <select id=\"openStockTakeCompany\" class=\"form-control\" required onchange=\"updateWarehousesForOpenStockTake()\">\n                                        <option value=\"\">Select Company</option>\n                                    </select>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"openStockTakeWarehouse\">Warehouse</label>\n                                    <select id=\"openStockTakeWarehouse\" class=\"form-control\" required onchange=\"validateManagerForWarehouse()\">\n                                        <option value=\"\">Select Warehouse</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div id=\"managerValidationMessage\" class=\"validation-message\" style=\"display: none;\"></div>\n                            <div class=\"button-group\">\n                                <button onclick=\"openStockTake()\" class=\"btn btn-primary\" id=\"openStockTakeBtn\">Open Stock Take</button>\n                                <button onclick=\"closeStockTake()\" class=\"btn btn-danger\" id=\"closeStockTakeBtn\" style=\"display: none;\">Close Stock Take</button>\n                            </div>\n                        </section>\n\n                        <!-- Scan Bin Location -->\n                        <section class=\"card scanning-section\" id=\"binLocationSection\" style=\"display: none;\">\n                            <div class=\"card-header\">\n                                <h2 class=\"card-title\">Scan Bin Location</h2>\n                            </div>\n                            <div id=\"currentBinLocation\" class=\"current-bin-box\" style=\"display: none;\">\n                                <h3>Current Bin: <span id=\"currentBinCode\"></span></h3>\n                                <p id=\"currentBinInfo\"></p>\n                            </div>\n                            <div class=\"scanning-container\">\n                                <div class=\"scan-input-large\">\n                                    <label for=\"binLocationInput\" class=\"scan-label\">Bin Location Code</label>\n                                    <p class=\"scan-hint\">Scan QR code or type bin code</p>\n                                    <div class=\"input-with-button-large\">\n                                        <input \n                                            type=\"text\" \n                                            id=\"binLocationInput\" \n                                            class=\"form-control scan-input\" \n                                            placeholder=\"Scan or enter bin code...\"\n                                            onkeypress=\"if(event.key==='Enter') handleBinLocationScan()\"\n                                            autocomplete=\"off\"\n                                            autofocus\n                                        >\n                                        <button onclick=\"startQRScan('binLocationInput', handleBinLocationScan)\" class=\"btn btn-secondary btn-large\" title=\"Scan QR Code\">Scan</button>\n                                        <button onclick=\"handleBinLocationScan()\" class=\"btn btn-primary btn-large\">Scan</button>\n                                    </div>\n                                    <button onclick=\"clearBinLocation()\" class=\"btn btn-link\" id=\"clearBinBtn\" style=\"display: none; margin-top: 10px;\">Clear Bin Location</button>\n                                </div>\n                            </div>\n                        </section>\n\n                        <!-- Scan Items -->\n                        <section class=\"card scanning-section\" id=\"itemScanSection\" style=\"display: none;\">\n                            <div class=\"card-header\">\n                                <h2 class=\"card-title\">Scan Items</h2>\n                            </div>\n                            <div class=\"scanning-container\">\n                                <div class=\"scan-input-large\">\n                                    <label for=\"itemCodeInput\" class=\"scan-label\">Item Code</label>\n                                    <p class=\"scan-hint\">Scan QR code for item</p>\n                                    <div class=\"input-with-button-large\">\n                                        <input \n                                            type=\"text\" \n                                            id=\"itemCodeInput\" \n                                            class=\"form-control scan-input\" \n                                            placeholder=\"Scan QR code or enter item code...\"\n                                            onkeypress=\"if(event.key==='Enter') handleItemCodeScan()\"\n                                            autocomplete=\"off\"\n                                            autofocus\n                                        >\n                                        <button onclick=\"startQRScan('itemCodeInput', handleItemCodeScan)\" class=\"btn btn-secondary btn-large\" title=\"Scan QR Code\">Scan</button>\n                                    </div>\n                                </div>\n                                \n                                <div class=\"form-row\">\n                                    <div class=\"form-group\">\n                                        <label for=\"itemNameInput\">Item Name</label>\n                                        <input \n                                            type=\"text\" \n                                            id=\"itemNameInput\" \n                                            class=\"form-control\" \n                                            placeholder=\"Auto-filled when item code is scanned\"\n                                            readonly\n                                            style=\"background-color: var(--bg-secondary);\"\n                                        >\n                                    </div>\n                                    <div class=\"form-group\">\n                                        <label for=\"itemQuantityInput\">Quantity</label>\n                                        <input \n                                            type=\"number\" \n                                            id=\"itemQuantityInput\" \n                                            class=\"form-control\" \n                                            min=\"0\" \n                                            value=\"1\"\n                                            required\n                                            inputmode=\"numeric\"\n                                            pattern=\"[0-9]*\"\n                                        >\n                                    </div>\n                                </div>\n                                \n                                <div class=\"button-group-center\">\n                                    <button onclick=\"addItemToBin()\" class=\"btn btn-primary btn-large\">Add Item to Bin</button>\n                                </div>\n                            </div>\n                        </section>\n\n                        <!-- Items in Current Bin -->\n                        <section class=\"card scanning-section\" id=\"binItemsSection\" style=\"display: none;\">\n                            <div class=\"card-header\">\n                                <h2 class=\"card-title\">Items in Current Bin</h2>\n                            </div>\n                            <div id=\"binItemsList\" class=\"items-list\"></div>\n                            <div id=\"noBinItems\" class=\"no-items\" style=\"display: none;\">No items added yet. Scan items above.</div>\n                            <div class=\"button-group\" style=\"margin-top: 20px;\">\n                                <button onclick=\"submitBinLocation()\" class=\"btn btn-success btn-large\" id=\"submitBinBtn\">Submit Bin Location</button>\n                                <button onclick=\"clearBinItems()\" class=\"btn btn-secondary btn-large\">Clear All Items</button>\n                            </div>\n                        </section>\n                    </div>\n\n                    <!-- Open Stock Takes Tab -->\n                    <div id=\"openStockTakesTab\" class=\"tab-content\" style=\"display: none;\">\n                        <div class=\"page-header\">\n                            <h1 class=\"page-title\">Open Stock Takes</h1>\n                            <p class=\"page-subtitle\">View and manage active stock takes</p>\n                        </div>\n                        <div class=\"card\">\n                            <div class=\"card-header\">\n                                <h2 class=\"card-title\">Active Stock Takes</h2>\n                                <button onclick=\"loadOpenStockTakes()\" class=\"btn btn-secondary btn-small\">Refresh</button>\n                            </div>\n                            <div id=\"openStockTakesList\" class=\"items-list\"></div>\n                            <div id=\"noOpenStockTakes\" class=\"no-items\" style=\"display: none;\">No open stock takes found.</div>\n                        </div>\n                    </div>\n\n                    <!-- Setup Tab -->\n                    <div id=\"setupTab\" class=\"tab-content\" style=\"display: none;\">\n                        <!-- Company Selection -->\n                        <div class=\"card\" style=\"margin-bottom: 2rem;\">\n                            <div class=\"card-header\">\n                                <h2 class=\"card-title\">Select Company</h2>\n                                <button onclick=\"openAddCompanyModal()\" class=\"btn btn-primary btn-small\">Add Company</button>\n                            </div>\n                            <div class=\"form-group\">\n                                <select id=\"selectedCompany\" class=\"form-control\" onchange=\"onCompanySelected()\" style=\"font-size: 1rem; padding: 0.75rem;\">\n                                    <option value=\"\">-- Select a Company --</option>\n                                </select>\n                            </div>\n                            <div id=\"companiesList\" class=\"items-list\" style=\"margin-top: 1.5rem;\"></div>\n                            <div id=\"noCompanies\" class=\"no-items\" style=\"display: none;\">No companies found</div>\n                        </div>\n\n                        <!-- Company Details (shown when company selected) -->\n                        <div id=\"companyDetailsSection\" style=\"display: none;\">\n                            <!-- Warehouses Section -->\n                            <div class=\"card\" style=\"margin-bottom: 2rem;\">\n                                <div class=\"card-header\">\n                                    <h2 class=\"card-title\">Warehouses</h2>\n                                    <button onclick=\"openAddWarehouseModal()\" class=\"btn btn-primary btn-small\">Add Warehouse</button>\n                                </div>\n                                <div id=\"warehousesList\" class=\"items-list\"></div>\n                                <div id=\"noWarehouses\" class=\"no-items\" style=\"display: none;\">No warehouses found</div>\n                            </div>\n\n                            <!-- Bin Locations Section -->\n                            <div class=\"card\" style=\"margin-bottom: 2rem;\">\n                                <div class=\"card-header\">\n                                    <h2 class=\"card-title\">Bin Locations</h2>\n                                    <button onclick=\"openAddBinLocationModal()\" class=\"btn btn-primary btn-small\">Add Bin Location</button>\n                                </div>\n                                <div class=\"form-group\" style=\"margin-bottom: 1.5rem;\">\n                                    <select id=\"binLocationWarehouseFilter\" class=\"form-control\" onchange=\"loadBinLocationsForCompany()\">\n                                        <option value=\"\">All Warehouses</option>\n                                    </select>\n                                </div>\n                                <div id=\"binLocationsList\" class=\"items-list\"></div>\n                                <div id=\"noBinLocations\" class=\"no-items\" style=\"display: none;\">No bin locations found</div>\n                            </div>\n\n                            <!-- Managers Section -->\n                            <div class=\"card\">\n                                <div class=\"card-header\">\n                                    <h2 class=\"card-title\">Managers</h2>\n                                    <button onclick=\"openAddManagerModal()\" class=\"btn btn-primary btn-small\">Add Manager</button>\n                                </div>\n                                <div class=\"form-group\" style=\"margin-bottom: 1.5rem;\">\n                                    <select id=\"managerWarehouseFilter\" class=\"form-control\" onchange=\"loadManagersForCompany()\">\n                                        <option value=\"\">All Warehouses</option>\n                                    </select>\n                                </div>\n                                <div id=\"managersList\" class=\"items-list\"></div>\n                                <div id=\"noManagers\" class=\"no-items\" style=\"display: none;\">No managers found</div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- System Admin Tab -->\n                    <div id=\"systemAdminTab\" class=\"tab-content\" style=\"display: none;\">\n                        <div class=\"page-header\">\n                            <h1 class=\"page-title\">System Administration</h1>\n                            <p class=\"page-subtitle\">Manage access permissions and system settings</p>\n                        </div>\n\n                        <!-- Password Protection -->\n                        <div id=\"systemAdminLogin\" class=\"card\" style=\"max-width: 500px; margin: 2rem auto;\">\n                            <div class=\"card-header\">\n                                <h2 class=\"card-title\">Admin Access Required</h2>\n                            </div>\n                            <div>\n                                <div class=\"form-group\">\n                                    <label for=\"adminPassword\">Enter Admin Password</label>\n                                    <input type=\"password\" id=\"adminPassword\" class=\"form-control\" placeholder=\"Enter password...\" required autofocus>\n                                </div>\n                                <div class=\"button-group\">\n                                    <button type=\"button\" id=\"accessAdminBtn\" class=\"btn btn-primary\" onclick=\"checkAdminPassword()\">Access Admin Panel</button>\n                                </div>\n                            </div>\n                            <div id=\"adminPasswordError\" class=\"error-message\" style=\"display: none; color: var(--error-color); margin-top: 1rem;\"></div>\n                        </div>\n\n                        <!-- Admin Panel Content (hidden until authenticated) -->\n                        <div id=\"systemAdminContent\" style=\"display: none;\">\n                            <!-- Manager-Company Access -->\n                            <div class=\"card\" style=\"margin-bottom: 2rem;\">\n                                <div class=\"card-header\">\n                                    <h2 class=\"card-title\">Manager-Company Access</h2>\n                                    <button onclick=\"openAddManagerCompanyAccessModal()\" class=\"btn btn-primary btn-small\">Add Access</button>\n                                </div>\n                                <div class=\"form-group\" style=\"margin-bottom: 1.5rem;\">\n                                    <select id=\"adminManagerFilter\" class=\"form-control\" onchange=\"loadManagerCompanyAccess()\">\n                                        <option value=\"\">All Managers</option>\n                                    </select>\n                                </div>\n                                <div id=\"managerCompanyAccessList\" class=\"items-list\"></div>\n                                <div id=\"noManagerAccess\" class=\"no-items\" style=\"display: none;\">No access records found</div>\n                            </div>\n\n                            <!-- Counter-Company Access -->\n                            <div class=\"card\">\n                                <div class=\"card-header\">\n                                    <h2 class=\"card-title\">Counter-Company Access</h2>\n                                    <button onclick=\"openAddCounterCompanyAccessModal()\" class=\"btn btn-primary btn-small\">Add Access</button>\n                                </div>\n                                <div class=\"form-group\" style=\"margin-bottom: 1.5rem;\">\n                                    <select id=\"adminCounterFilter\" class=\"form-control\" onchange=\"loadCounterCompanyAccess()\">\n                                        <option value=\"\">All Counters</option>\n                                    </select>\n                                </div>\n                                <div id=\"counterCompanyAccessList\" class=\"items-list\"></div>\n                                <div id=\"noCounterAccess\" class=\"no-items\" style=\"display: none;\">No access records found</div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- View Items Tab -->\n                    <div id=\"viewTab\" class=\"tab-content\" style=\"display: none;\">\n                        <div class=\"view-items-page\">\n                            <div class=\"view-items-header\">\n                                <div>\n                                    <h1 class=\"page-title\">Stock Items</h1>\n                                    <p class=\"page-subtitle\">View and manage all stock items</p>\n                                </div>\n                                <button onclick=\"loadItems()\" class=\"btn btn-secondary\">Refresh</button>\n                            </div>\n                            \n                            <div class=\"view-items-filters\">\n                                <div class=\"form-row\">\n                                    <div class=\"form-group\">\n                                        <label>Filter by Company</label>\n                                        <select id=\"viewCompanyFilter\" class=\"form-control\" onchange=\"applyViewFilters()\">\n                                            <option value=\"\">All Companies</option>\n                                        </select>\n                                    </div>\n                                    <div class=\"form-group\">\n                                        <label>Filter by Warehouse</label>\n                                        <select id=\"viewWarehouseFilter\" class=\"form-control\" onchange=\"applyViewFilters()\">\n                                            <option value=\"\">All Warehouses</option>\n                                        </select>\n                                    </div>\n                                    <div class=\"form-group\">\n                                        <label>Search Items</label>\n                                        <input \n                                            type=\"text\" \n                                            id=\"viewItemsSearch\" \n                                            class=\"form-control\" \n                                            placeholder=\"Search by item code or name...\"\n                                            onkeyup=\"applyViewFilters()\"\n                                        >\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class=\"view-items-content\">\n                                <div id=\"viewItemsLoading\" class=\"loading-state\" style=\"display: none;\">\n                                    <p>Loading items...</p>\n                                </div>\n                                <div id=\"viewItemsList\" class=\"view-items-list\"></div>\n                                <div id=\"viewItemsEmpty\" class=\"no-items\" style=\"display: none;\">\n                                    <p>No items found.</p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n    </div>\n\n    <!-- Modals -->\n    <!-- Add/Edit Company Modal -->\n    <div id=\"companyModal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h3 id=\"companyModalTitle\">Add Company</h3>\n                <button class=\"modal-close\" onclick=\"closeCompanyModal()\">&times;</button>\n            </div>\n            <form id=\"companyForm\" onsubmit=\"handleCompanySubmit(event)\">\n                <div class=\"form-group\">\n                    <label for=\"companyName\">Company Name</label>\n                    <input type=\"text\" id=\"companyName\" class=\"form-control\" required>\n                </div>\n                <div class=\"modal-actions\">\n                    <button type=\"button\" onclick=\"closeCompanyModal()\" class=\"btn btn-secondary\">Cancel</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Save</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Add/Edit Warehouse Modal -->\n    <div id=\"warehouseModal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h3 id=\"warehouseModalTitle\">Add Warehouse</h3>\n                <button class=\"modal-close\" onclick=\"closeWarehouseModal()\">&times;</button>\n            </div>\n            <form id=\"warehouseForm\" onsubmit=\"handleWarehouseSubmit(event)\">\n                <div class=\"form-group\">\n                    <label for=\"warehouseName\">Warehouse Name</label>\n                    <input type=\"text\" id=\"warehouseName\" class=\"form-control\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"warehouseAddress\">Address (Optional)</label>\n                    <input type=\"text\" id=\"warehouseAddress\" class=\"form-control\">\n                </div>\n                <div class=\"modal-actions\">\n                    <button type=\"button\" onclick=\"closeWarehouseModal()\" class=\"btn btn-secondary\">Cancel</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Save</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Add/Edit Bin Location Modal -->\n    <div id=\"binLocationModal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h3 id=\"binLocationModalTitle\">Add Bin Location</h3>\n                <button class=\"modal-close\" onclick=\"closeBinLocationModal()\">&times;</button>\n            </div>\n            <form id=\"binLocationForm\" onsubmit=\"handleBinLocationSubmit(event)\">\n                <div class=\"form-group\">\n                    <label for=\"binCode\">Bin Code</label>\n                    <input type=\"text\" id=\"binCode\" class=\"form-control\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"binName\">Bin Name (Optional)</label>\n                    <input type=\"text\" id=\"binName\" class=\"form-control\">\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"binWarehouse\">Warehouse</label>\n                    <select id=\"binWarehouse\" class=\"form-control\" required>\n                        <option value=\"\">Select Warehouse</option>\n                    </select>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"binAisle\">Aisle (Optional)</label>\n                    <input type=\"text\" id=\"binAisle\" class=\"form-control\">\n                </div>\n                <div class=\"modal-actions\">\n                    <button type=\"button\" onclick=\"closeBinLocationModal()\" class=\"btn btn-secondary\">Cancel</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Save</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Add/Edit Manager Modal -->\n    <div id=\"managerModal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h3 id=\"managerModalTitle\">Add Manager</h3>\n                <button class=\"modal-close\" onclick=\"closeManagerModal()\">&times;</button>\n            </div>\n            <form id=\"managerForm\" onsubmit=\"handleManagerSubmit(event)\">\n                <div class=\"form-group\">\n                    <label for=\"managerName\">Manager Name</label>\n                    <input type=\"text\" id=\"managerName\" class=\"form-control\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"managerEmail\">Email (Optional)</label>\n                    <input type=\"email\" id=\"managerEmail\" class=\"form-control\">\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"managerWarehouse\">Warehouse</label>\n                    <select id=\"managerWarehouse\" class=\"form-control\" required>\n                        <option value=\"\">Select Warehouse</option>\n                    </select>\n                </div>\n                <div class=\"modal-actions\">\n                    <button type=\"button\" onclick=\"closeManagerModal()\" class=\"btn btn-secondary\">Cancel</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Save</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Add/Edit Manager-Company Access Modal -->\n    <div id=\"managerCompanyAccessModal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h3 id=\"managerCompanyAccessModalTitle\">Add Manager-Company Access</h3>\n                <button class=\"modal-close\" onclick=\"closeManagerCompanyAccessModal()\">&times;</button>\n            </div>\n            <form id=\"managerCompanyAccessForm\" onsubmit=\"handleManagerCompanyAccessSubmit(event)\">\n                <div class=\"form-group\">\n                    <label for=\"accessManager\">Manager</label>\n                    <select id=\"accessManager\" class=\"form-control\" required>\n                        <option value=\"\">Select Manager</option>\n                    </select>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"accessCompany\">Company</label>\n                    <select id=\"accessCompany\" class=\"form-control\" required>\n                        <option value=\"\">Select Company</option>\n                    </select>\n                </div>\n                <div class=\"modal-actions\">\n                    <button type=\"button\" onclick=\"closeManagerCompanyAccessModal()\" class=\"btn btn-secondary\">Cancel</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Save</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Add/Edit Counter-Company Access Modal -->\n    <div id=\"counterCompanyAccessModal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h3 id=\"counterCompanyAccessModalTitle\">Add Counter-Company Access</h3>\n                <button class=\"modal-close\" onclick=\"closeCounterCompanyAccessModal()\">&times;</button>\n            </div>\n            <form id=\"counterCompanyAccessForm\" onsubmit=\"handleCounterCompanyAccessSubmit(event)\">\n                <div class=\"form-group\">\n                    <label for=\"accessCounterEmail\">Counter Email/Login</label>\n                    <input type=\"email\" id=\"accessCounterEmail\" class=\"form-control\" placeholder=\"user@example.com\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"accessCounterCompany\">Company</label>\n                    <select id=\"accessCounterCompany\" class=\"form-control\" required>\n                        <option value=\"\">Select Company</option>\n                    </select>\n                </div>\n                <div class=\"modal-actions\">\n                    <button type=\"button\" onclick=\"closeCounterCompanyAccessModal()\" class=\"btn btn-secondary\">Cancel</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Save</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- QR Scanner Modal -->\n    <div id=\"qrScannerModal\" class=\"modal\">\n        <div class=\"modal-content qr-scanner-content\">\n            <div class=\"modal-header\">\n                <h3>Scan QR Code</h3>\n                <button class=\"modal-close\" onclick=\"stopQRScan()\">&times;</button>\n            </div>\n            <div id=\"qr-reader\" style=\"width:100%;\"></div>\n            <div id=\"qr-reader-results\"></div>\n            <p class=\"qr-hint\">Position the QR code within the camera view</p>\n        </div>\n    </div>\n\n    <!-- System Admin Button (Bottom Left) -->\n    <button id=\"systemAdminBtn\" class=\"system-admin-btn\" onclick=\"showTab('systemAdmin')\" title=\"System Admin\">\n        <span class=\"system-admin-icon\">üîê</span>\n        <span class=\"system-admin-label\">Admin</span>\n    </button>\n\n    <script src=\"/js/config.js\"></script>\n    <script src=\"js/auth.js\"></script>\n    <script src=\"/js/app.js\"></script>\n</body>\n</html>\n";

export const configJs = "/**\n * Configuration\n * Uses same domain as frontend - no CORS issues!\n */\n\nconst CONFIG = {\n    // API server URL - Same domain as frontend\n    apiUrl: window.location.origin + '/api',\n};\n\n// Make available globally\nwindow.CONFIG = CONFIG;";

export const appJs = "/**\n * Stock Take Management System\n * Complete warehouse inventory management with company, warehouse, bin location, and manager setup\n */\n\n// Global state\nlet allItems = [];\nlet filteredItems = [];\nlet companies = [];\nlet warehouses = [];\nlet binLocations = [];\nlet managers = [];\nlet currentRole = 'manager'; // 'counter' or 'manager'\n// currentStockTake already declared at top of file\nlet currentBinLocation = null;\nlet currentBinItems = [];\nlet qrScanner = null; // QR Code scanner instance\n\n// System Admin password (defined early so it's available everywhere)\nconst ADMIN_PASSWORD = 'admin123'; // TODO: Change this to a secure password or use environment variable\n\n// Define selectRole function immediately so it's available for onclick handlers\nfunction selectRole(role) {\n    try {\n        console.log('Selecting role:', role);\n        \n        // Check if user is authenticated\n        if (typeof isAuthenticated === 'function' && !isAuthenticated()) {\n            showToast('Please sign in with Microsoft first', 'warning', 3000);\n            if (typeof signIn === 'function') {\n                signIn();\n            }\n            return;\n        }\n        \n        if (!role || (role !== 'counter' && role !== 'manager')) {\n            console.error('Invalid role:', role);\n            return;\n        }\n        \n        localStorage.setItem('stockTakeRole', role);\n        \n        const roleSelectionScreen = document.getElementById('roleSelectionScreen');\n        const mainApp = document.getElementById('mainApp');\n        \n        if (!roleSelectionScreen || !mainApp) {\n            console.error('Required DOM elements not found');\n            showToast('Error: Page elements not found. Please refresh the page.', 'error', 5000);\n            return;\n        }\n        \n        roleSelectionScreen.style.display = 'none';\n        mainApp.style.display = 'block';\n        \n        // Small delay to ensure DOM is ready\n        setTimeout(() => {\n            initializeApp(role);\n        }, 50);\n    } catch (error) {\n        console.error('Error in selectRole:', error);\n        showToast('Error selecting role: ' + error.message, 'error', 5000);\n    }\n}\n\n// Make function available globally immediately\nif (typeof window !== 'undefined') {\n    window.selectRole = selectRole;\n    console.log('selectRole function registered on window');\n}\n\n/**\n * Initialize app\n */\ndocument.addEventListener('DOMContentLoaded', () => {\n    console.log('Stock Take Management System initialized');\n    console.log('selectRole function available:', typeof window.selectRole);\n    console.log('selectRole function available (direct):', typeof selectRole);\n    \n    // Add event listeners to role buttons using IDs\n    const counterBtn = document.getElementById('counterBtn');\n    const managerBtn = document.getElementById('managerBtn');\n    \n    console.log('Counter button found:', !!counterBtn);\n    console.log('Manager button found:', !!managerBtn);\n    \n    if (counterBtn) {\n        // Use mousedown as well to catch all interactions\n        ['click', 'mousedown', 'touchstart'].forEach(eventType => {\n            counterBtn.addEventListener(eventType, function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                console.log('Counter button ' + eventType + ' event!');\n                try {\n                    if (typeof selectRole === 'function') {\n                        selectRole('counter');\n                    } else if (typeof window.selectRole === 'function') {\n                        window.selectRole('counter');\n                    } else {\n                        throw new Error('selectRole function not found');\n                    }\n                } catch (error) {\n                    console.error('Error in counter button click:', error);\n                    showToast(error.message, 'error', 5000);\n                }\n            }, { passive: false });\n        });\n        console.log('Counter button event listeners added');\n    } else {\n        console.error('Counter button not found!');\n    }\n    \n    if (managerBtn) {\n        // Use mousedown as well to catch all interactions\n        ['click', 'mousedown', 'touchstart'].forEach(eventType => {\n            managerBtn.addEventListener(eventType, function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                console.log('Manager button ' + eventType + ' event!');\n                try {\n                    if (typeof selectRole === 'function') {\n                        selectRole('manager');\n                    } else if (typeof window.selectRole === 'function') {\n                        window.selectRole('manager');\n                    } else {\n                        throw new Error('selectRole function not found');\n                    }\n                } catch (error) {\n                    console.error('Error in manager button click:', error);\n                    showToast(error.message, 'error', 5000);\n                }\n            }, { passive: false });\n        });\n        console.log('Manager button event listeners added');\n    } else {\n        console.error('Manager button not found!');\n    }\n    \n    // Don't show role selection until user is authenticated\n    // Authentication check will handle showing the appropriate screen\n    const roleScreen = document.getElementById('roleSelectionScreen');\n    const mainApp = document.getElementById('mainApp');\n    \n    if (roleScreen) {\n        roleScreen.style.display = 'none';\n    }\n    if (mainApp) {\n        mainApp.style.display = 'none';\n    }\n    \n    // Clear any saved role to force selection\n    localStorage.removeItem('stockTakeRole');\n    \n    // Wait for auth to initialize, then check authentication\n    setTimeout(async () => {\n        if (typeof isAuthenticated === 'function') {\n            if (!isAuthenticated()) {\n                // Auth will show login screen\n                if (typeof blockAccessUntilLogin === 'function') {\n                    blockAccessUntilLogin();\n                }\n            } else {\n                // User is authenticated, check if they're a manager\n                await checkUserManagerStatus();\n                \n                // Show role selection\n                if (roleScreen) {\n                    roleScreen.style.display = 'flex';\n                }\n                \n                // Add authenticated class to body for CSS\n                document.body.classList.add('authenticated');\n            }\n        } else {\n            // Auth not loaded yet, wait a bit more\n            setTimeout(() => {\n                if (typeof blockAccessUntilLogin === 'function') {\n                    blockAccessUntilLogin();\n                }\n            }, 500);\n        }\n    }, 200);\n});\n\nfunction initializeApp(role) {\n    try {\n        console.log('Initializing app with role:', role);\n        currentRole = role;\n        \n        // Ensure authenticated class is on body\n        document.body.classList.add('authenticated');\n        \n        // Update UI based on role\n        setRole(role, false); // Don't save (already saved)\n        \n        // Load initial data\n        loadCompanies().then(() => {\n            // After companies load, load other data\n            loadWarehouses();\n            loadBinLocations();\n            loadManagers().then(() => {\n                // After managers load, update company/warehouse dropdowns for stock take\n                updateCompanyDropdowns();\n                updateWarehouseDropdowns();\n            });\n        }).catch(error => {\n            console.error('Error loading initial data:', error);\n        });\n        \n        // Load open stock takes if in counter mode\n        if (role === 'counter') {\n            loadOpenStockTakes();\n        }\n        \n        // Initialize stock take status\n        setTimeout(() => {\n            const stocktakeTab = document.getElementById('stocktakeTab');\n            if (stocktakeTab && stocktakeTab.classList.contains('active')) {\n                updateStockTakeStatus();\n            }\n        }, 100);\n    } catch (error) {\n        console.error('Error in initializeApp:', error);\n        showToast('Error initializing app. Please refresh the page.', 'error', 5000);\n    }\n}\n\n// selectRole function is now defined at the top of the file for immediate availability\n\n// Check if current user is a manager\nasync function checkUserManagerStatus() {\n    try {\n        // Get current user email\n        let userEmail = null;\n        if (typeof getCurrentUser === 'function') {\n            const user = getCurrentUser();\n            if (user && user.email) {\n                userEmail = user.email;\n            }\n        }\n        \n        // Also check sessionStorage for email auth\n        if (!userEmail) {\n            userEmail = sessionStorage.getItem('loggedInUserEmail');\n        }\n        \n        if (!userEmail) {\n            console.log('No user email found, hiding manager option');\n            hideManagerOption();\n            return;\n        }\n        \n        // Load all managers\n        const managersResponse = await fetch(`${CONFIG.apiUrl}/managers`);\n        if (!managersResponse.ok) {\n            console.log('Failed to load managers, hiding manager option');\n            hideManagerOption();\n            return;\n        }\n        \n        const allManagers = await managersResponse.json();\n        \n        // Find manager with matching email\n        const matchingManager = allManagers.find(m => \n            m.email && m.email.toLowerCase() === userEmail.toLowerCase()\n        );\n        \n        if (!matchingManager) {\n            console.log('No manager found with email:', userEmail);\n            hideManagerOption();\n            return;\n        }\n        \n        // Check if this manager has any company access\n        const accessResponse = await fetch(`${CONFIG.apiUrl}/manager-company-access?manager_id=${matchingManager.id}`);\n        if (!accessResponse.ok) {\n            console.log('Failed to check manager access, hiding manager option');\n            hideManagerOption();\n            return;\n        }\n        \n        const accessList = await accessResponse.json();\n        \n        if (accessList && accessList.length > 0) {\n            console.log('User is a manager, showing manager option');\n            showManagerOption();\n        } else {\n            console.log('Manager has no company access, hiding manager option');\n            hideManagerOption();\n        }\n    } catch (error) {\n        console.error('Error checking manager status:', error);\n        // On error, hide manager option for security\n        hideManagerOption();\n    }\n}\n\nfunction hideManagerOption() {\n    const managerBtn = document.getElementById('managerBtn');\n    if (managerBtn) {\n        managerBtn.style.display = 'none';\n    }\n}\n\nfunction showManagerOption() {\n    const managerBtn = document.getElementById('managerBtn');\n    if (managerBtn) {\n        managerBtn.style.display = 'flex';\n    }\n}\n\nfunction switchRole() {\n    // Clear role and show role selection screen\n    localStorage.removeItem('stockTakeRole');\n    \n    const roleScreen = document.getElementById('roleSelectionScreen');\n    const mainApp = document.getElementById('mainApp');\n    \n    if (roleScreen) roleScreen.style.display = 'flex';\n    if (mainApp) mainApp.style.display = 'none';\n    \n    // Re-check manager status when switching roles\n    checkUserManagerStatus();\n}\nwindow.switchRole = switchRole;\n\n// ========== ROLE MANAGEMENT ==========\nfunction setRole(role, saveToStorage = true) {\n    currentRole = role;\n    \n    if (saveToStorage) {\n        localStorage.setItem('stockTakeRole', role);\n    }\n    \n    // Update subtitle\n    const subtitle = document.getElementById('roleSubtitle');\n    if (subtitle) {\n        subtitle.textContent = role === 'counter' \n            ? 'Scan, count, and submit inventory' \n            : 'Manage companies, warehouses, and view reports';\n    }\n    \n    // Update role badge\n    const roleBadge = document.getElementById('roleBadge');\n    if (roleBadge) {\n        roleBadge.textContent = role.charAt(0).toUpperCase() + role.slice(1);\n        roleBadge.className = 'role-badge ' + role;\n    }\n    \n    // Build navigation items (hides navigation for counter)\n    buildNavigation(role);\n    \n    // Counter mode: Show ONLY the counting interface, hide everything else\n    if (role === 'counter') {\n        // Hide entire header\n        const appHeader = document.getElementById('appHeader');\n        if (appHeader) appHeader.style.display = 'none';\n        \n        // Hide page header in content\n        const pageHeader = document.querySelector('.page-header');\n        if (pageHeader) pageHeader.style.display = 'none';\n        \n        // Hide ALL other tabs completely\n        const openStockTakesTab = document.getElementById('openStockTakesTab');\n        const setupTab = document.getElementById('setupTab');\n        const viewTab = document.getElementById('viewTab');\n        \n        if (openStockTakesTab) openStockTakesTab.style.display = 'none';\n        if (setupTab) setupTab.style.display = 'none';\n        if (viewTab) viewTab.style.display = 'none';\n        \n        // Hide all sections except counter start\n        const counterStartSection = document.getElementById('counterStartSection');\n        const managerStockTakeSection = document.getElementById('managerStockTakeSection');\n        const binLocationSection = document.getElementById('binLocationSection');\n        const itemScanSection = document.getElementById('itemScanSection');\n        const binItemsSection = document.getElementById('binItemsSection');\n        \n        if (counterStartSection) counterStartSection.style.display = 'block';\n        if (managerStockTakeSection) managerStockTakeSection.style.display = 'none';\n        if (binLocationSection) binLocationSection.style.display = 'none';\n        if (itemScanSection) itemScanSection.style.display = 'none';\n        if (binItemsSection) binItemsSection.style.display = 'none';\n        \n        // Show ONLY stocktake tab content\n        const stocktakeTab = document.getElementById('stocktakeTab');\n        if (stocktakeTab) {\n            stocktakeTab.classList.add('active');\n            stocktakeTab.style.display = 'block';\n        }\n        \n        // Add a small \"Switch Role\" button at the bottom for counter\n        addCounterSwitchButton();\n        \n        // Focus on counter bin input\n        setTimeout(() => {\n            const counterBinInput = document.getElementById('counterBinLocationInput');\n            if (counterBinInput) counterBinInput.focus();\n        }, 100);\n    } else {\n        // Manager mode: Show everything\n        const appHeader = document.getElementById('appHeader');\n        if (appHeader) appHeader.style.display = 'flex';\n        \n        const pageHeader = document.querySelector('.page-header');\n        if (pageHeader) pageHeader.style.display = 'block';\n        \n        // Show all tabs\n        const openStockTakesTab = document.getElementById('openStockTakesTab');\n        const setupTab = document.getElementById('setupTab');\n        const viewTab = document.getElementById('viewTab');\n        \n        if (openStockTakesTab) openStockTakesTab.style.display = 'block';\n        if (setupTab) setupTab.style.display = 'block';\n        if (viewTab) viewTab.style.display = 'block';\n        \n        // Show manager section, hide counter section\n        const counterStartSection = document.getElementById('counterStartSection');\n        const managerStockTakeSection = document.getElementById('managerStockTakeSection');\n        if (counterStartSection) counterStartSection.style.display = 'none';\n        if (managerStockTakeSection) managerStockTakeSection.style.display = 'block';\n        \n        // Also hide the scanning sections for manager mode\n        const binLocationSection = document.getElementById('binLocationSection');\n        const itemScanSection = document.getElementById('itemScanSection');\n        const binItemsSection = document.getElementById('binItemsSection');\n        if (binLocationSection) binLocationSection.style.display = 'none';\n        if (itemScanSection) itemScanSection.style.display = 'none';\n        if (binItemsSection) binItemsSection.style.display = 'none';\n        \n        // Remove counter switch button if it exists\n        const counterSwitchBtn = document.getElementById('counterSwitchRoleBtn');\n        if (counterSwitchBtn) counterSwitchBtn.remove();\n        \n        // Switch to stock take tab by default\n        const stocktakeTab = document.getElementById('stocktakeTab');\n        if (stocktakeTab && !stocktakeTab.classList.contains('active')) {\n            try {\n                showTab('stocktake');\n            } catch (error) {\n                console.error('Error switching to stocktake tab:', error);\n            }\n        }\n    }\n}\nwindow.setRole = setRole;\n\n/**\n * Tab switching\n */\n// Build navigation menu\nfunction buildNavigation(role) {\n    const navItems = [];\n    \n    // Counter sees NOTHING - no navigation at all\n    if (role === 'counter') {\n        // Hide sidebar and mobile nav completely\n        const sidebar = document.getElementById('sidebar');\n        const mobileNav = document.getElementById('mobileNav');\n        if (sidebar) sidebar.style.display = 'none';\n        if (mobileNav) mobileNav.style.display = 'none';\n        \n        // Update main content to take full width\n        const mainContent = document.querySelector('.main-content');\n        if (mainContent) mainContent.style.marginLeft = '0';\n        \n        // System Admin button will be shown in bottom left (handled by CSS)\n        return;\n    } else {\n        // Manager sees all navigation\n        navItems.push(\n            { id: 'stocktake', label: 'Stock Take', icon: 'üì¶' },\n            { id: 'openStockTakes', label: 'Open Stock Takes', icon: 'üìã' },\n            { id: 'setup', label: 'Setup', icon: '‚öôÔ∏è' },\n            { id: 'view', label: 'View Items', icon: 'üìä' }\n        );\n        \n        // Show sidebar and mobile nav for manager\n        const sidebar = document.getElementById('sidebar');\n        const mobileNav = document.getElementById('mobileNav');\n        if (sidebar) {\n            sidebar.style.display = 'block';\n            sidebar.style.width = ''; // Reset to default\n        }\n        if (mobileNav) mobileNav.style.display = 'block';\n        \n        // Restore main content margin\n        const mainContent = document.querySelector('.main-content');\n        if (mainContent) mainContent.style.marginLeft = 'var(--sidebar-width)';\n    }\n    \n    // Update sidebar navigation\n    const sidebarNav = document.getElementById('sidebarNav');\n    if (sidebarNav) {\n        sidebarNav.innerHTML = navItems.map(item => `\n            <div class=\"nav-item\" onclick=\"showTab('${item.id}')\" data-tab=\"${item.id}\">\n                <span class=\"nav-icon\">${item.icon}</span>\n                <span class=\"nav-label\">${item.label}</span>\n            </div>\n        `).join('');\n    }\n    \n    // System Admin button visibility is handled by CSS based on .authenticated class\n}\n\nfunction showTab(tabName, clickedElement) {\n    // Check if tab is allowed for current role\n    if (tabName === 'setup' && currentRole === 'counter') {\n        showToast('Setup is only available in Manager mode', 'warning', 3000);\n        return;\n    }\n    if (tabName === 'view' && currentRole === 'counter') {\n        showToast('View Items is only available in Manager mode', 'warning', 3000);\n        return;\n    }\n    \n    // Hide ALL tabs completely\n    document.querySelectorAll('.tab-content').forEach(tab => {\n        tab.classList.remove('active');\n        tab.style.display = 'none';\n    });\n    \n    // Show ONLY the selected tab\n    const tabElement = document.getElementById(tabName + 'Tab');\n    if (tabElement) {\n        tabElement.classList.add('active');\n        tabElement.style.display = 'block';\n    }\n    \n    // Update navigation active state\n    document.querySelectorAll('.nav-item').forEach(item => {\n        item.classList.remove('active');\n        if (item.dataset.tab === tabName) {\n            item.classList.add('active');\n        }\n    });\n    \n    \n    // Update page title\n    const pageTitle = document.getElementById('pageTitle');\n    if (pageTitle) {\n        const titles = {\n            'stocktake': 'Stock Take',\n            'openStockTakes': 'Open Stock Takes',\n            'setup': 'Setup',\n            'view': 'View Items',\n            'systemAdmin': 'System Admin'\n        };\n        pageTitle.textContent = titles[tabName] || 'Stock Take';\n    } else {\n        // Find the tab button by ID\n        const tabBtnId = tabName + 'TabBtn';\n        const tabBtn = document.getElementById(tabBtnId);\n        if (tabBtn) {\n            tabBtn.classList.add('active');\n        }\n    }\n    \n    // Load data when switching tabs\n    if (tabName === 'setup') {\n        loadCompanies();\n        loadWarehouses();\n        // If a company is already selected, load its data\n        if (selectedCompanyId) {\n            onCompanySelected();\n        }\n    } else if (tabName === 'stocktake') {\n        // Ensure managers are loaded for validation\n        if (managers.length === 0) {\n            loadManagers();\n        }\n        // Update dropdowns\n        updateCompanyDropdowns();\n        updateWarehouseDropdowns();\n        // Update stock take status\n        updateStockTakeStatus();\n    } else if (tabName === 'view') {\n        updateViewFilters();\n        if (allItems.length === 0) {\n            loadItems();\n        } else {\n            applyViewFilters();\n        }\n    } else if (tabName === 'openStockTakes') {\n        loadOpenStockTakes();\n    } else if (tabName === 'systemAdmin') {\n        // Update page title\n        if (pageTitle) {\n            pageTitle.textContent = 'System Admin';\n        }\n        \n        // Check if already authenticated\n        if (!isAdminAuthenticated()) {\n            showAdminLogin();\n            // Focus password input and ensure button works after a short delay\n            setTimeout(() => {\n                const passwordInput = document.getElementById('adminPassword');\n                const accessBtn = document.getElementById('accessAdminBtn');\n                \n                if (passwordInput) {\n                    passwordInput.focus();\n                    // Handle Enter key\n                    passwordInput.addEventListener('keypress', function(e) {\n                        if (e.key === 'Enter') {\n                            e.preventDefault();\n                            checkAdminPassword();\n                        }\n                    });\n                }\n                \n                // Ensure button click works\n                if (accessBtn) {\n                    // Remove any existing listeners\n                    const newBtn = accessBtn.cloneNode(true);\n                    accessBtn.parentNode.replaceChild(newBtn, accessBtn);\n                    \n                    // Add click handler\n                    newBtn.addEventListener('click', function(e) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        console.log('Button clicked - calling checkAdminPassword');\n                        checkAdminPassword();\n                    });\n                    \n                    // Also ensure onclick works\n                    newBtn.onclick = function(e) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        console.log('Button onclick - calling checkAdminPassword');\n                        checkAdminPassword();\n                    };\n                }\n            }, 200);\n        } else {\n            showAdminContent();\n        }\n    }\n}\nwindow.showTab = showTab;\n\n// Show setup page\nfunction showSetupPage(pageName) {\n    // Hide ALL setup pages first\n    document.querySelectorAll('.setup-page').forEach(page => {\n        page.classList.remove('active');\n        page.style.display = 'none';\n    });\n    \n    // Show ONLY the selected page\n    const pageElement = document.getElementById(`setupPage-${pageName}`);\n    if (pageElement) {\n        pageElement.classList.add('active');\n        pageElement.style.display = 'block';\n    }\n    \n    // Update navigation active state\n    document.querySelectorAll('.setup-nav-item').forEach(item => {\n        item.classList.remove('active');\n        if (item.dataset.setupPage === pageName) {\n            item.classList.add('active');\n        }\n    });\n    \n    // Load data for the page\n    switch(pageName) {\n        case 'companies':\n            loadCompanies();\n            break;\n        case 'warehouses':\n            loadWarehousesForSetup();\n            break;\n        case 'binLocations':\n            loadBinLocationsForSetup();\n            break;\n        case 'managers':\n            loadManagersForSetup();\n            break;\n    }\n}\nwindow.showSetupPage = showSetupPage;\n\n// Update filter dropdowns for setup pages\nfunction updateSetupFilterDropdowns() {\n    // Update company filters\n    const companyFilters = ['warehouseCompanyFilter', 'binLocationCompanyFilter', 'managerCompanyFilter'];\n    companyFilters.forEach(filterId => {\n        const filter = document.getElementById(filterId);\n        if (filter) {\n            const currentValue = filter.value;\n            filter.innerHTML = '<option value=\"\">All Companies</option>' + \n                companies.map(c => `<option value=\"${c.id}\">${escapeHtml(c.company_name)}</option>`).join('');\n            if (currentValue) filter.value = currentValue;\n        }\n    });\n    \n    // Update warehouse filters (will be updated when company is selected)\n    updateBinLocationWarehouseFilter();\n    updateManagerWarehouseFilter();\n}\nwindow.updateSetupFilterDropdowns = updateSetupFilterDropdowns;\n\n// ========== COMPANY SELECTION & SETTINGS ==========\nlet selectedCompanyId = null;\n\nfunction onCompanySelected() {\n    const companyId = document.getElementById('selectedCompany').value;\n    selectedCompanyId = companyId ? parseInt(companyId) : null;\n    \n    const companyDetailsSection = document.getElementById('companyDetailsSection');\n    \n    if (selectedCompanyId) {\n        // Show company details section\n        if (companyDetailsSection) {\n            companyDetailsSection.style.display = 'block';\n        }\n        \n        // Load all data for this company\n        loadWarehousesForCompany();\n        loadBinLocationsForCompany();\n        loadManagersForCompany();\n    } else {\n        // Hide company details section\n        if (companyDetailsSection) {\n            companyDetailsSection.style.display = 'none';\n        }\n    }\n}\nwindow.onCompanySelected = onCompanySelected;\n\nfunction editSelectedCompany() {\n    if (selectedCompanyId) {\n        openEditCompanyModal(selectedCompanyId);\n    }\n}\nwindow.editSelectedCompany = editSelectedCompany;\n\nfunction selectCompany(companyId) {\n    document.getElementById('selectedCompany').value = companyId;\n    onCompanySelected();\n}\nwindow.selectCompany = selectCompany;\n\n// ========== COMPANIES ==========\nasync function loadCompanies() {\n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/companies`);\n        companies = await response.json();\n        \n        // Update dropdowns\n        updateCompanyDropdowns();\n        \n        // Update company selector dropdown\n        updateCompanyDropdowns();\n        \n        // Display companies in list (only if no company selected)\n        const listEl = document.getElementById('companiesList');\n        const noCompaniesEl = document.getElementById('noCompanies');\n        if (listEl) {\n            if (companies.length === 0) {\n                listEl.innerHTML = '';\n                if (noCompaniesEl) noCompaniesEl.style.display = 'block';\n            } else {\n                if (noCompaniesEl) noCompaniesEl.style.display = 'none';\n                listEl.innerHTML = companies.map(c => `\n                    <div class=\"item-card\" onclick=\"selectCompany(${c.id})\" style=\"cursor: pointer;\">\n                        <div class=\"item-header\">\n                            <h3>${escapeHtml(c.company_name)}</h3>\n                            <span class=\"item-id\">${escapeHtml(c.company_code)}</span>\n                        </div>\n                        <div class=\"item-details\">\n                            <p>Click to configure this company's warehouses, bin locations, and managers</p>\n                        </div>\n                        <div class=\"item-actions\">\n                            <button onclick=\"event.stopPropagation(); selectCompany(${c.id})\" class=\"btn btn-small\">Configure</button>\n                            <button onclick=\"event.stopPropagation(); editCompany(${c.id})\" class=\"btn btn-small\">Edit</button>\n                            <button onclick=\"event.stopPropagation(); deleteCompany(${c.id})\" class=\"btn btn-small btn-danger\">Delete</button>\n                        </div>\n                    </div>\n                `).join('');\n            }\n        }\n    } catch (error) {\n        console.error('Error loading companies:', error);\n    }\n}\n\nfunction updateCompanyDropdowns() {\n    const selects = document.querySelectorAll('select[id*=\"Company\"], select[id*=\"company\"]');\n    selects.forEach(select => {\n        const currentValue = select.value;\n        const placeholder = select.id === 'selectedCompany' ? '-- Select a Company --' : 'Select Company';\n        select.innerHTML = `<option value=\"\">${placeholder}</option>` + \n            companies.map(c => `<option value=\"${c.id}\">${escapeHtml(c.company_name)}</option>`).join('');\n        if (currentValue) select.value = currentValue;\n    });\n}\n\nfunction openCompanyModal(id = null) {\n    if (id) {\n        openEditCompanyModal(id);\n    } else {\n        openAddCompanyModal();\n    }\n}\nwindow.openCompanyModal = openCompanyModal;\n\nfunction openAddCompanyModal() {\n    const modal = document.getElementById('companyModal');\n    const form = document.getElementById('companyForm');\n    const title = document.getElementById('companyModalTitle');\n    \n    if (modal && form && title) {\n        title.textContent = 'Add Company';\n        form.reset();\n        // Remove any hidden ID field if it exists\n        const idField = document.getElementById('editCompanyId');\n        if (idField) idField.remove();\n        modal.style.display = 'flex';\n    }\n}\nwindow.openAddCompanyModal = openAddCompanyModal;\n\nfunction closeCompanyModal() {\n    const modal = document.getElementById('companyModal');\n    if (modal) modal.style.display = 'none';\n}\nwindow.closeCompanyModal = closeCompanyModal;\nwindow.closeAddCompanyModal = closeCompanyModal; // Alias for backward compatibility\n\nfunction openEditCompanyModal(id) {\n    const company = companies.find(c => c.id === id);\n    if (!company) return;\n    \n    const modal = document.getElementById('companyModal');\n    const form = document.getElementById('companyForm');\n    const title = document.getElementById('companyModalTitle');\n    const companyName = document.getElementById('companyName');\n    \n    if (modal && form && title && companyName) {\n        title.textContent = 'Edit Company';\n        \n        // Add hidden ID field if it doesn't exist\n        let idField = document.getElementById('editCompanyId');\n        if (!idField) {\n            idField = document.createElement('input');\n            idField.type = 'hidden';\n            idField.id = 'editCompanyId';\n            form.appendChild(idField);\n        }\n        idField.value = id;\n        \n        companyName.value = company.company_name;\n        \n        // Set company code if field exists\n        const companyCode = document.getElementById('companyCode');\n        if (companyCode && company.company_code) {\n            companyCode.value = company.company_code;\n        }\n        \n        modal.style.display = 'flex';\n    }\n}\nwindow.openEditCompanyModal = openEditCompanyModal;\n\nasync function handleCompanySubmit(event) {\n    event.preventDefault();\n    const idField = document.getElementById('editCompanyId');\n    const isEdit = idField && idField.value;\n    \n    const companyName = document.getElementById('companyName');\n    if (!companyName) {\n        showToast('Company name field not found', 'error', 3000);\n        return;\n    }\n    \n    const formData = {\n        company_name: companyName.value.trim(),\n    };\n    \n    // Add company_code if it exists (for backward compatibility)\n    const companyCode = document.getElementById('companyCode');\n    if (companyCode) {\n        formData.company_code = companyCode.value.trim();\n    }\n    \n    try {\n        let response;\n        if (isEdit) {\n            response = await fetch(`${CONFIG.apiUrl}/companies/${idField.value}`, {\n                method: 'PUT',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(formData)\n            });\n        } else {\n            response = await fetch(`${CONFIG.apiUrl}/companies`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(formData)\n            });\n        }\n        \n        if (!response.ok) throw new Error(isEdit ? 'Failed to update company' : 'Failed to save company');\n        \n        const result = await response.json();\n        showToast(isEdit ? 'Company updated successfully!' : 'Company created successfully!', 'success', 3000);\n        closeCompanyModal();\n        await loadCompanies();\n        \n        if (!isEdit && result.item && result.item.id) {\n            // Auto-select the newly created company\n            selectCompanyInDropdown(result.item.id);\n        } else if (isEdit && selectedCompanyId) {\n            // Keep the same company selected if editing\n            const companySelect = document.getElementById('selectedCompany');\n            if (companySelect) {\n                companySelect.value = selectedCompanyId;\n            }\n            onCompanySelected();\n        }\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.handleCompanySubmit = handleCompanySubmit;\n\nfunction editCompany(id) {\n    openCompanyModal(id);\n}\nwindow.editCompany = editCompany;\n\nasync function deleteCompany(id) {\n    if (!confirm('Are you sure you want to delete this company?')) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/companies/${id}`, { method: 'DELETE' });\n        if (!response.ok) throw new Error('Failed to delete company');\n        showToast('Company deleted successfully!', 'success', 3000);\n        selectedCompanyId = null;\n        const companySelect = document.getElementById('selectedCompany');\n        if (companySelect) {\n            companySelect.value = '';\n        }\n        await loadCompanies();\n        onCompanySelected(); // This will hide the company details section\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.deleteCompany = deleteCompany;\n\n// ========== WAREHOUSES ==========\nasync function loadWarehouses() {\n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/warehouses`);\n        warehouses = await response.json();\n        updateWarehouseDropdowns();\n    } catch (error) {\n        console.error('Error loading warehouses:', error);\n    }\n}\n\nasync function loadWarehousesForCompany() {\n    if (!selectedCompanyId) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/warehouses?company_id=${selectedCompanyId}`);\n        const companyWarehouses = await response.json();\n        \n        const listEl = document.getElementById('warehousesList');\n        const noWarehousesEl = document.getElementById('noWarehouses');\n        \n        if (listEl) {\n            if (companyWarehouses.length === 0) {\n                listEl.innerHTML = '';\n                if (noWarehousesEl) noWarehousesEl.style.display = 'block';\n            } else {\n                if (noWarehousesEl) noWarehousesEl.style.display = 'none';\n                listEl.innerHTML = companyWarehouses.map(w => `\n                    <div class=\"item-card\">\n                        <div class=\"item-header\">\n                            <div>\n                                <h3>${escapeHtml(w.warehouse_name)}</h3>\n                                <p style=\"color: var(--text-muted); font-size: 0.875rem; margin: 0.25rem 0 0 0;\">${escapeHtml(w.warehouse_code)}</p>\n                                ${w.address ? `<p style=\"color: var(--text-secondary); font-size: 0.85rem; margin: 0.25rem 0 0 0;\">${escapeHtml(w.address)}</p>` : ''}\n                            </div>\n                            <div class=\"item-actions\">\n                                <button onclick=\"editWarehouse(${w.id})\" class=\"btn btn-small\">Edit</button>\n                                <button onclick=\"deleteWarehouse(${w.id})\" class=\"btn btn-small btn-danger\">Delete</button>\n                            </div>\n                        </div>\n                    </div>\n                `).join('');\n            }\n        }\n        \n        // Update warehouse filter dropdowns for bin locations and managers\n        const binFilter = document.getElementById('binLocationWarehouseFilter');\n        const managerFilter = document.getElementById('managerWarehouseFilter');\n        \n        if (binFilter) {\n            const currentValue = binFilter.value;\n            binFilter.innerHTML = '<option value=\"\">All Warehouses</option>' + \n                companyWarehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n            if (currentValue) binFilter.value = currentValue;\n        }\n        \n        if (managerFilter) {\n            const currentValue = managerFilter.value;\n            managerFilter.innerHTML = '<option value=\"\">All Warehouses</option>' + \n                companyWarehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n            if (currentValue) managerFilter.value = currentValue;\n        }\n    } catch (error) {\n        console.error('Error loading warehouses for company:', error);\n    }\n}\nwindow.loadWarehousesForCompany = loadWarehousesForCompany;\n\n// Load warehouses for setup page (with company filter)\nasync function loadWarehousesForSetup() {\n    try {\n        const companyFilter = document.getElementById('warehouseCompanyFilter')?.value || '';\n        let url = `${CONFIG.apiUrl}/warehouses`;\n        if (companyFilter) {\n            url += `?company_id=${companyFilter}`;\n        }\n        \n        const response = await fetch(url);\n        const warehouseList = await response.json();\n        \n        const listEl = document.getElementById('warehousesList');\n        const noWarehousesEl = document.getElementById('noWarehouses');\n        \n        if (listEl) {\n            if (warehouseList.length === 0) {\n                listEl.innerHTML = '';\n                if (noWarehousesEl) noWarehousesEl.style.display = 'block';\n            } else {\n                if (noWarehousesEl) noWarehousesEl.style.display = 'none';\n                listEl.innerHTML = warehouseList.map(w => {\n                    const company = companies.find(c => c.id === w.company_id);\n                    return `\n                        <div class=\"item-card\">\n                            <div class=\"item-header\">\n                                <div>\n                                    <h3>${escapeHtml(w.warehouse_name)}</h3>\n                                    <p style=\"color: var(--text-muted); font-size: 0.875rem; margin: 0.25rem 0 0 0;\">${escapeHtml(company ? company.company_name : 'N/A')}</p>\n                                </div>\n                                <span class=\"item-id\">${escapeHtml(w.warehouse_code)}</span>\n                            </div>\n                            <div class=\"item-actions\">\n                                <button onclick=\"editWarehouse(${w.id})\" class=\"btn btn-small\">Edit</button>\n                                <button onclick=\"deleteWarehouse(${w.id})\" class=\"btn btn-small btn-danger\">Delete</button>\n                            </div>\n                        </div>\n                    `;\n                }).join('');\n            }\n        }\n    } catch (error) {\n        console.error('Error loading warehouses for setup:', error);\n    }\n}\nwindow.loadWarehousesForSetup = loadWarehousesForSetup;\n\nfunction updateWarehouseDropdowns() {\n    const selects = document.querySelectorAll('select[id*=\"Warehouse\"], select[id*=\"warehouse\"]');\n    selects.forEach(select => {\n        // Skip filter dropdowns - they're updated separately\n        if (select.id === 'binLocationWarehouseFilter' || select.id === 'managerWarehouseFilter') {\n            return;\n        }\n        \n        const currentValue = select.value;\n        let filteredWarehouses = warehouses;\n        \n        // If we have a selected company, filter by it\n        if (selectedCompanyId && select.id !== 'warehouseCompanyFilter') {\n            filteredWarehouses = warehouses.filter(w => w.company_id === selectedCompanyId);\n        }\n        \n        select.innerHTML = '<option value=\"\">Select Warehouse</option>' + \n            filteredWarehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n        if (currentValue) select.value = currentValue;\n    });\n}\n\nfunction updateWarehouseFilterDropdowns() {\n    // Update filter dropdowns with warehouses for selected company\n    const binFilter = document.getElementById('binLocationWarehouseFilter');\n    const managerFilter = document.getElementById('managerWarehouseFilter');\n    \n    const companyWarehouses = warehouses.filter(w => w.company_id === selectedCompanyId);\n    \n    if (binFilter) {\n        const currentValue = binFilter.value;\n        binFilter.innerHTML = '<option value=\"\">All Warehouses</option>' + \n            companyWarehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n        if (currentValue) binFilter.value = currentValue;\n    }\n    \n    if (managerFilter) {\n        const currentValue = managerFilter.value;\n        managerFilter.innerHTML = '<option value=\"\">All Warehouses</option>' + \n            companyWarehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n        if (currentValue) managerFilter.value = currentValue;\n    }\n}\n\nfunction openWarehouseModal(id = null) {\n    if (id) {\n        openEditWarehouseModal(id);\n    } else {\n        openAddWarehouseModal();\n    }\n}\nwindow.openWarehouseModal = openWarehouseModal;\n\nfunction openAddWarehouseModal() {\n    const modal = document.getElementById('warehouseModal');\n    const form = document.getElementById('warehouseForm');\n    const title = document.getElementById('warehouseModalTitle');\n    \n    if (modal && form && title) {\n        title.textContent = 'Add Warehouse';\n        form.reset();\n        // Remove any hidden ID field if it exists\n        const idField = document.getElementById('editWarehouseId');\n        if (idField) idField.remove();\n        \n        // Pre-select the current company if one is selected (if there's a company field)\n        if (selectedCompanyId) {\n            const companyField = document.getElementById('warehouseCompany');\n            if (companyField) {\n                companyField.value = selectedCompanyId;\n            }\n        }\n        \n        modal.style.display = 'flex';\n    }\n}\nwindow.openAddWarehouseModal = openAddWarehouseModal;\n\nfunction closeWarehouseModal() {\n    const modal = document.getElementById('warehouseModal');\n    if (modal) modal.style.display = 'none';\n}\nwindow.closeWarehouseModal = closeWarehouseModal;\nwindow.closeAddWarehouseModal = closeAddWarehouseModal;\n\nfunction openEditWarehouseModal(id) {\n    const warehouse = warehouses.find(w => w.id === id);\n    if (!warehouse) return;\n    \n    const companySelect = document.getElementById('editWarehouseCompany');\n    companySelect.innerHTML = '<option value=\"\">Select Company</option>' + \n        companies.map(c => `<option value=\"${c.id}\">${escapeHtml(c.company_name)}</option>`).join('');\n    \n    document.getElementById('editWarehouseId').value = id;\n    document.getElementById('editWarehouseCode').value = warehouse.warehouse_code;\n    document.getElementById('editWarehouseName').value = warehouse.warehouse_name;\n    document.getElementById('editWarehouseCompany').value = warehouse.company_id;\n    document.getElementById('editWarehouseAddress').value = warehouse.address || '';\n    document.getElementById('editWarehouseModal').style.display = 'flex';\n}\nwindow.openEditWarehouseModal = openEditWarehouseModal;\n\n\nasync function handleAddWarehouse(event) {\n    event.preventDefault();\n    const formData = {\n        warehouse_code: document.getElementById('addWarehouseCode').value.trim(),\n        warehouse_name: document.getElementById('addWarehouseName').value.trim(),\n        company_id: parseInt(document.getElementById('addWarehouseCompany').value),\n        address: document.getElementById('addWarehouseAddress').value.trim() || null,\n    };\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/warehouses`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(formData)\n        });\n        \n        if (!response.ok) throw new Error('Failed to save warehouse');\n        \n        showToast('Warehouse created successfully!', 'success', 3000);\n        closeWarehouseModal();\n        await loadWarehouses();\n        loadWarehousesForCompany();\n        loadBinLocationsForCompany();\n        loadManagersForCompany();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.handleAddWarehouse = handleAddWarehouse;\n\nasync function handleEditWarehouse(event) {\n    event.preventDefault();\n    const id = document.getElementById('editWarehouseId').value;\n    const formData = {\n        warehouse_code: document.getElementById('editWarehouseCode').value.trim(),\n        warehouse_name: document.getElementById('editWarehouseName').value.trim(),\n        company_id: parseInt(document.getElementById('editWarehouseCompany').value),\n        address: document.getElementById('editWarehouseAddress').value.trim() || null,\n    };\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/warehouses/${id}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(formData)\n        });\n        \n        if (!response.ok) throw new Error('Failed to update warehouse');\n        \n        showToast('Warehouse updated successfully!', 'success', 3000);\n        closeWarehouseModal();\n        await loadWarehouses();\n        loadWarehousesForCompany();\n        loadBinLocationsForCompany();\n        loadManagersForCompany();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.handleEditWarehouse = handleEditWarehouse;\n\nfunction editWarehouse(id) {\n    openWarehouseModal(id);\n}\nwindow.editWarehouse = editWarehouse;\n\nasync function deleteWarehouse(id) {\n    if (!confirm('Are you sure you want to delete this warehouse? This will also delete associated bin locations and managers.')) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/warehouses/${id}`, { method: 'DELETE' });\n        if (!response.ok) throw new Error('Failed to delete warehouse');\n        showToast('Warehouse deleted successfully!', 'success', 3000);\n        await loadWarehouses();\n        loadWarehousesForCompany();\n        loadBinLocationsForCompany();\n        loadManagersForCompany();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.deleteWarehouse = deleteWarehouse;\n\n// ========== BIN LOCATIONS ==========\nasync function loadBinLocations() {\n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/bin-locations`);\n        binLocations = await response.json();\n        updateBinLocationDropdowns();\n    } catch (error) {\n        console.error('Error loading bin locations:', error);\n    }\n}\n\nasync function loadBinLocationsForCompany() {\n    if (!selectedCompanyId) return;\n    \n    try {\n        const warehouseFilter = document.getElementById('binLocationWarehouseFilter')?.value || '';\n        let url = `${CONFIG.apiUrl}/bin-locations`;\n        \n        // If warehouse filter is set, use it; otherwise get all bins for company's warehouses\n        if (warehouseFilter) {\n            url += `?warehouse_id=${warehouseFilter}`;\n        } else {\n            // Get all warehouses for this company first\n            const companyWarehouses = warehouses.filter(w => w.company_id === selectedCompanyId);\n            if (companyWarehouses.length > 0) {\n                // Fetch bins for all company warehouses\n                const allBins = [];\n                for (const wh of companyWarehouses) {\n                    const response = await fetch(`${CONFIG.apiUrl}/bin-locations?warehouse_id=${wh.id}`);\n                    const bins = await response.json();\n                    allBins.push(...bins);\n                }\n                binLocations = allBins;\n            } else {\n                binLocations = [];\n            }\n        }\n        \n        if (warehouseFilter) {\n            const response = await fetch(url);\n            binLocations = await response.json();\n        }\n        \n        updateBinLocationDropdowns();\n        \n        const listEl = document.getElementById('binLocationsList');\n        const noBinLocationsEl = document.getElementById('noBinLocations');\n        \n        if (listEl) {\n            if (binLocations.length === 0) {\n                listEl.innerHTML = '';\n                if (noBinLocationsEl) noBinLocationsEl.style.display = 'block';\n            } else {\n                if (noBinLocationsEl) noBinLocationsEl.style.display = 'none';\n                listEl.innerHTML = binLocations.map(b => {\n                    const warehouse = warehouses.find(w => w.id === b.warehouse_id);\n                    return `\n                        <div class=\"item-card\">\n                            <div class=\"item-header\">\n                                <div>\n                                    <h3>${escapeHtml(b.bin_code)}</h3>\n                                    <p style=\"color: var(--text-muted); font-size: 0.875rem; margin: 0.25rem 0 0 0;\">${escapeHtml(warehouse ? warehouse.warehouse_name : 'N/A')}</p>\n                                    ${b.aisle ? `<p style=\"color: var(--text-secondary); font-size: 0.85rem; margin: 0.25rem 0 0 0;\">Aisle: ${escapeHtml(b.aisle)}</p>` : ''}\n                                </div>\n                                <div class=\"item-actions\">\n                                    <button onclick=\"editBinLocation(${b.id})\" class=\"btn btn-small\">Edit</button>\n                                    <button onclick=\"deleteBinLocation(${b.id})\" class=\"btn btn-small btn-danger\">Delete</button>\n                                </div>\n                            </div>\n                        </div>\n                    `;\n                }).join('');\n            }\n        }\n    } catch (error) {\n        console.error('Error loading bin locations for company:', error);\n    }\n}\nwindow.loadBinLocationsForCompany = loadBinLocationsForCompany;\n\nfunction updateBinLocationDropdowns() {\n    const selects = document.querySelectorAll('select[id*=\"Bin\"], select[id*=\"bin\"]');\n    selects.forEach(select => {\n        // Skip filter dropdown\n        if (select.id === 'binLocationWarehouseFilter') return;\n        \n        const currentValue = select.value;\n        let filteredBins = binLocations;\n        \n        // If we have a selected company, filter bins by company's warehouses\n        if (selectedCompanyId) {\n            const companyWarehouseIds = warehouses.filter(w => w.company_id === selectedCompanyId).map(w => w.id);\n            filteredBins = binLocations.filter(b => companyWarehouseIds.includes(b.warehouse_id));\n        }\n        \n        select.innerHTML = '<option value=\"\">Select Bin Location</option>' + \n            filteredBins.map(b => `<option value=\"${b.id}\">${escapeHtml(b.bin_code)}${b.bin_name ? ' - ' + escapeHtml(b.bin_name) : ''}</option>`).join('');\n        if (currentValue) select.value = currentValue;\n    });\n}\n\nfunction openBinLocationModal(id = null) {\n    if (id) {\n        openEditBinLocationModal(id);\n    } else {\n        openAddBinLocationModal();\n    }\n}\nwindow.openBinLocationModal = openBinLocationModal;\n\nfunction openAddBinLocationModal() {\n    const modal = document.getElementById('binLocationModal');\n    const form = document.getElementById('binLocationForm');\n    const title = document.getElementById('binLocationModalTitle');\n    const warehouseSelect = document.getElementById('binWarehouse');\n    \n    if (modal && form && title && warehouseSelect) {\n        title.textContent = 'Add Bin Location';\n        form.reset();\n        // Remove any hidden ID field if it exists\n        const idField = document.getElementById('editBinLocationId');\n        if (idField) idField.remove();\n        \n        // Filter warehouses by selected company\n        let filteredWarehouses = warehouses;\n        if (selectedCompanyId) {\n            filteredWarehouses = warehouses.filter(w => w.company_id === selectedCompanyId);\n        }\n        \n        warehouseSelect.innerHTML = '<option value=\"\">Select Warehouse</option>' + \n            filteredWarehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n        \n        modal.style.display = 'flex';\n    }\n}\nwindow.openAddBinLocationModal = openAddBinLocationModal;\n\nfunction closeBinLocationModal() {\n    const modal = document.getElementById('binLocationModal');\n    if (modal) modal.style.display = 'none';\n}\nwindow.closeBinLocationModal = closeBinLocationModal;\n\nfunction openEditBinLocationModal(id) {\n    const bin = binLocations.find(b => b.id === id);\n    if (!bin) return;\n    \n    const warehouseSelect = document.getElementById('editBinLocationWarehouse');\n    warehouseSelect.innerHTML = '<option value=\"\">Select Warehouse</option>' + \n        warehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n    \n    document.getElementById('editBinLocationId').value = id;\n    document.getElementById('editBinLocationCode').value = bin.bin_code;\n    document.getElementById('editBinLocationName').value = bin.bin_name || '';\n    document.getElementById('editBinLocationWarehouse').value = bin.warehouse_id;\n    document.getElementById('editBinLocationAisle').value = bin.aisle || '';\n    document.getElementById('editBinLocationShelf').value = bin.shelf || '';\n    document.getElementById('editBinLocationLevel').value = bin.level || '';\n    document.getElementById('editBinLocationModal').style.display = 'flex';\n}\nwindow.openEditBinLocationModal = openEditBinLocationModal;\n\n\nasync function handleAddBinLocation(event) {\n    event.preventDefault();\n    const formData = {\n        bin_code: document.getElementById('addBinLocationCode').value.trim(),\n        bin_name: document.getElementById('addBinLocationName').value.trim() || null,\n        warehouse_id: parseInt(document.getElementById('addBinLocationWarehouse').value),\n        aisle: document.getElementById('addBinLocationAisle').value.trim() || null,\n        shelf: document.getElementById('addBinLocationShelf').value.trim() || null,\n        level: document.getElementById('addBinLocationLevel').value.trim() || null,\n    };\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/bin-locations`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(formData)\n        });\n        \n        if (!response.ok) throw new Error('Failed to save bin location');\n        \n        showToast('Bin location created successfully!', 'success', 3000);\n        closeBinLocationModal();\n        await loadBinLocations();\n        loadBinLocationsForCompany();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.handleAddBinLocation = handleAddBinLocation;\n\nasync function handleEditBinLocation(event) {\n    event.preventDefault();\n    const id = document.getElementById('editBinLocationId').value;\n    const formData = {\n        bin_code: document.getElementById('editBinLocationCode').value.trim(),\n        bin_name: document.getElementById('editBinLocationName').value.trim() || null,\n        warehouse_id: parseInt(document.getElementById('editBinLocationWarehouse').value),\n        aisle: document.getElementById('editBinLocationAisle').value.trim() || null,\n        shelf: document.getElementById('editBinLocationShelf').value.trim() || null,\n        level: document.getElementById('editBinLocationLevel').value.trim() || null,\n    };\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/bin-locations/${id}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(formData)\n        });\n        \n        if (!response.ok) throw new Error('Failed to update bin location');\n        \n        showToast('Bin location updated successfully!', 'success', 3000);\n        closeBinLocationModal();\n        await loadBinLocations();\n        loadBinLocationsForCompany();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.handleEditBinLocation = handleEditBinLocation;\n\nfunction editBinLocation(id) {\n    openBinLocationModal(id);\n}\nwindow.editBinLocation = editBinLocation;\n\nasync function deleteBinLocation(id) {\n    if (!confirm('Are you sure you want to delete this bin location?')) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/bin-locations/${id}`, { method: 'DELETE' });\n        if (!response.ok) throw new Error('Failed to delete bin location');\n        showToast('Bin location deleted successfully!', 'success', 3000);\n        await loadBinLocations();\n        loadBinLocationsForCompany();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.deleteBinLocation = deleteBinLocation;\n\n// ========== MANAGERS ==========\nasync function loadManagers() {\n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/managers`);\n        managers = await response.json();\n        updateManagerDropdowns();\n    } catch (error) {\n        console.error('Error loading managers:', error);\n    }\n}\n\nasync function loadManagersForCompany() {\n    if (!selectedCompanyId) return;\n    \n    try {\n        const warehouseFilter = document.getElementById('managerWarehouseFilter')?.value || '';\n        let url = `${CONFIG.apiUrl}/managers`;\n        \n        if (warehouseFilter) {\n            url += `?warehouse_id=${warehouseFilter}`;\n        } else {\n            // Get all managers for company's warehouses\n            const companyWarehouses = warehouses.filter(w => w.company_id === selectedCompanyId);\n            if (companyWarehouses.length > 0) {\n                const allManagers = [];\n                for (const wh of companyWarehouses) {\n                    const response = await fetch(`${CONFIG.apiUrl}/managers?warehouse_id=${wh.id}`);\n                    const mgrs = await response.json();\n                    allManagers.push(...mgrs);\n                }\n                managers = allManagers;\n            } else {\n                managers = [];\n            }\n        }\n        \n        if (warehouseFilter) {\n            const response = await fetch(url);\n            managers = await response.json();\n        }\n        \n        updateManagerDropdowns();\n        \n        const listEl = document.getElementById('managersList');\n        const noManagersEl = document.getElementById('noManagers');\n        \n        if (listEl) {\n            if (managers.length === 0) {\n                listEl.innerHTML = '';\n                if (noManagersEl) noManagersEl.style.display = 'block';\n            } else {\n                if (noManagersEl) noManagersEl.style.display = 'none';\n                listEl.innerHTML = managers.map(m => `\n                    <div class=\"item-card\">\n                        <div class=\"item-header\">\n                            <div>\n                                <h3>${escapeHtml(m.manager_name)}</h3>\n                                <p style=\"color: var(--text-muted); font-size: 0.875rem; margin: 0.25rem 0 0 0;\">${escapeHtml(m.warehouse_name || 'N/A')}</p>\n                                ${m.email ? `<p style=\"color: var(--text-secondary); font-size: 0.85rem; margin: 0.25rem 0 0 0;\">${escapeHtml(m.email)}</p>` : ''}\n                            </div>\n                            <div style=\"display: flex; align-items: center; gap: 1rem;\">\n                                <span class=\"${m.is_active ? 'status-active' : 'status-inactive'}\" style=\"font-size: 0.8rem; padding: 0.25rem 0.5rem; border-radius: 4px;\">${m.is_active ? 'Active' : 'Inactive'}</span>\n                                <div class=\"item-actions\">\n                                    <button onclick=\"editManager(${m.id})\" class=\"btn btn-small\">Edit</button>\n                                    <button onclick=\"deleteManager(${m.id})\" class=\"btn btn-small btn-danger\">Delete</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `).join('');\n            }\n        }\n    } catch (error) {\n        console.error('Error loading managers for company:', error);\n    }\n}\nwindow.loadManagersForCompany = loadManagersForCompany;\n\n// Load managers for setup page (with filters)\nasync function loadManagersForSetup() {\n    try {\n        const companyFilter = document.getElementById('managerCompanyFilter')?.value || '';\n        const warehouseFilter = document.getElementById('managerWarehouseFilter')?.value || '';\n        \n        let url = `${CONFIG.apiUrl}/managers`;\n        const params = [];\n        if (companyFilter) params.push(`company_id=${companyFilter}`);\n        if (warehouseFilter) params.push(`warehouse_id=${warehouseFilter}`);\n        if (params.length > 0) {\n            url += '?' + params.join('&');\n        }\n        \n        const response = await fetch(url);\n        const managerList = await response.json();\n        \n        const listEl = document.getElementById('managersList');\n        const noManagersEl = document.getElementById('noManagers');\n        \n        if (listEl) {\n            if (managerList.length === 0) {\n                listEl.innerHTML = '';\n                if (noManagersEl) noManagersEl.style.display = 'block';\n            } else {\n                if (noManagersEl) noManagersEl.style.display = 'none';\n                listEl.innerHTML = managerList.map(m => {\n                    const company = companies.find(c => c.id === m.company_id);\n                    const warehouse = warehouses.find(w => w.id === m.warehouse_id);\n                    return `\n                        <div class=\"item-card\">\n                            <div class=\"item-header\">\n                                <h3>${escapeHtml(m.manager_name)}</h3>\n                                ${m.email ? `<span class=\"item-id\">${escapeHtml(m.email)}</span>` : ''}\n                            </div>\n                            <div class=\"item-details\">\n                                <div class=\"detail-item\"><strong>Company:</strong> ${escapeHtml(company ? company.company_name : 'N/A')}</div>\n                                <div class=\"detail-item\"><strong>Warehouse:</strong> ${escapeHtml(warehouse ? warehouse.warehouse_name : 'N/A')}</div>\n                                ${m.phone ? `<div class=\"detail-item\"><strong>Phone:</strong> ${escapeHtml(m.phone)}</div>` : ''}\n                                <div class=\"detail-item\"><strong>Status:</strong> <span class=\"${m.is_active ? 'status-active' : 'status-inactive'}\">${m.is_active ? 'Active' : 'Inactive'}</span></div>\n                            </div>\n                            <div class=\"item-actions\">\n                                <button onclick=\"editManager(${m.id})\" class=\"btn btn-small\">Edit</button>\n                                <button onclick=\"deleteManager(${m.id})\" class=\"btn btn-small btn-danger\">Delete</button>\n                            </div>\n                        </div>\n                    `;\n                }).join('');\n            }\n        }\n    } catch (error) {\n        console.error('Error loading managers for setup:', error);\n    }\n}\nwindow.loadManagersForSetup = loadManagersForSetup;\n\n// Update warehouse filter when company filter changes\nfunction updateManagerWarehouseFilter() {\n    const companyFilter = document.getElementById('managerCompanyFilter')?.value || '';\n    const warehouseFilter = document.getElementById('managerWarehouseFilter');\n    \n    if (warehouseFilter) {\n        const currentValue = warehouseFilter.value;\n        let filteredWarehouses = warehouses;\n        \n        if (companyFilter) {\n            filteredWarehouses = warehouses.filter(w => w.company_id == companyFilter);\n        }\n        \n        warehouseFilter.innerHTML = '<option value=\"\">All Warehouses</option>' + \n            filteredWarehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n        if (currentValue) warehouseFilter.value = currentValue;\n        \n        loadManagersForSetup();\n    }\n}\nwindow.updateManagerWarehouseFilter = updateManagerWarehouseFilter;\n\nfunction updateManagerDropdowns() {\n    const selects = document.querySelectorAll('select[id*=\"Manager\"], select[id*=\"manager\"]');\n    selects.forEach(select => {\n        // Skip filter dropdown\n        if (select.id === 'managerWarehouseFilter') return;\n        \n        const currentValue = select.value;\n        let filteredManagers = managers;\n        \n        // If we have a selected company, filter managers by company's warehouses\n        if (selectedCompanyId) {\n            const companyWarehouseIds = warehouses.filter(w => w.company_id === selectedCompanyId).map(w => w.id);\n            filteredManagers = managers.filter(m => companyWarehouseIds.includes(m.warehouse_id));\n        }\n        \n        select.innerHTML = '<option value=\"\">Select Manager</option>' + \n            filteredManagers.map(m => `<option value=\"${m.id}\">${escapeHtml(m.manager_name)} - ${escapeHtml(m.warehouse_name || 'N/A')}</option>`).join('');\n        if (currentValue) select.value = currentValue;\n    });\n}\n\nfunction openManagerModal(id = null) {\n    if (id) {\n        openEditManagerModal(id);\n    } else {\n        openAddManagerModal();\n    }\n}\nwindow.openManagerModal = openManagerModal;\n\nfunction openAddManagerModal() {\n    const modal = document.getElementById('managerModal');\n    const form = document.getElementById('managerForm');\n    const title = document.getElementById('managerModalTitle');\n    const warehouseSelect = document.getElementById('managerWarehouse');\n    \n    if (modal && form && title && warehouseSelect) {\n        title.textContent = 'Add Manager';\n        form.reset();\n        // Remove any hidden ID field if it exists\n        const idField = document.getElementById('editManagerId');\n        if (idField) idField.remove();\n        \n        // Filter warehouses by selected company\n        let filteredWarehouses = warehouses;\n        if (selectedCompanyId) {\n            filteredWarehouses = warehouses.filter(w => w.company_id === selectedCompanyId);\n        }\n        \n        warehouseSelect.innerHTML = '<option value=\"\">Select Warehouse</option>' + \n            filteredWarehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n        \n        modal.style.display = 'flex';\n    }\n}\nwindow.openAddManagerModal = openAddManagerModal;\n\nfunction closeManagerModal() {\n    const modal = document.getElementById('managerModal');\n    if (modal) modal.style.display = 'none';\n}\nwindow.closeManagerModal = closeManagerModal;\n\nfunction openEditManagerModal(id) {\n    const manager = managers.find(m => m.id === id);\n    if (!manager) return;\n    \n    const warehouseSelect = document.getElementById('editManagerWarehouse');\n    warehouseSelect.innerHTML = '<option value=\"\">Select Warehouse</option>' + \n        warehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n    \n    document.getElementById('editManagerId').value = id;\n    document.getElementById('editManagerName').value = manager.manager_name;\n    document.getElementById('editManagerWarehouse').value = manager.warehouse_id;\n    document.getElementById('editManagerEmail').value = manager.email || '';\n    document.getElementById('editManagerPhone').value = manager.phone || '';\n    document.getElementById('editManagerModal').style.display = 'flex';\n}\nwindow.openEditManagerModal = openEditManagerModal;\n\n\nasync function handleAddManager(event) {\n    event.preventDefault();\n    const formData = {\n        manager_name: document.getElementById('addManagerName').value.trim(),\n        warehouse_id: parseInt(document.getElementById('addManagerWarehouse').value),\n        email: document.getElementById('addManagerEmail').value.trim() || null,\n        phone: document.getElementById('addManagerPhone').value.trim() || null,\n    };\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/managers`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(formData)\n        });\n        \n        if (!response.ok) throw new Error('Failed to save manager');\n        \n        showToast('Manager created successfully!', 'success', 3000);\n        closeManagerModal();\n        await loadManagers();\n        loadManagersForCompany();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.handleAddManager = handleAddManager;\n\nasync function handleEditManager(event) {\n    event.preventDefault();\n    const id = document.getElementById('editManagerId').value;\n    const formData = {\n        manager_name: document.getElementById('editManagerName').value.trim(),\n        warehouse_id: parseInt(document.getElementById('editManagerWarehouse').value),\n        email: document.getElementById('editManagerEmail').value.trim() || null,\n        phone: document.getElementById('editManagerPhone').value.trim() || null,\n    };\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/managers/${id}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(formData)\n        });\n        \n        if (!response.ok) throw new Error('Failed to update manager');\n        \n        showToast('Manager updated successfully!', 'success', 3000);\n        closeManagerModal();\n        await loadManagers();\n        loadManagersForCompany();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.handleEditManager = handleEditManager;\n\nfunction editManager(id) {\n    openManagerModal(id);\n}\nwindow.editManager = editManager;\n\nasync function deleteManager(id) {\n    if (!confirm('Are you sure you want to deactivate this manager?')) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/managers/${id}`, { method: 'DELETE' });\n        if (!response.ok) throw new Error('Failed to deactivate manager');\n        showToast('Manager deactivated successfully!', 'success', 3000);\n        await loadManagers();\n        loadManagersForCompany();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.deleteManager = deleteManager;\n\n// ========== STOCK TAKE ==========\nfunction updateWarehousesForStock() {\n    const companyId = document.getElementById('stockCompany').value;\n    const warehouseSelect = document.getElementById('stockWarehouse');\n    \n    warehouseSelect.innerHTML = '<option value=\"\">Select Warehouse</option>';\n    if (companyId) {\n        const companyWarehouses = warehouses.filter(w => w.company_id == companyId);\n        companyWarehouses.forEach(w => {\n            warehouseSelect.innerHTML += `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`;\n        });\n    }\n    \n    // Clear dependent fields\n    document.getElementById('stockWarehouse').value = '';\n    updateManagersAndBins();\n}\nwindow.updateWarehousesForStock = updateWarehousesForStock;\n\nfunction updateManagersAndBins() {\n    const warehouseId = document.getElementById('stockWarehouse').value;\n    const managerSelect = document.getElementById('stockManager');\n    const binSelect = document.getElementById('stockBinLocation');\n    \n    // Update managers (only for selected warehouse)\n    managerSelect.innerHTML = '<option value=\"\">Select Manager</option>';\n    if (warehouseId) {\n        const warehouseManagers = managers.filter(m => m.warehouse_id == warehouseId);\n        warehouseManagers.forEach(m => {\n            managerSelect.innerHTML += `<option value=\"${m.id}\">${escapeHtml(m.manager_name)}</option>`;\n        });\n    }\n    \n    // Update bin locations (only for selected warehouse)\n    binSelect.innerHTML = '<option value=\"\">Select Bin Location</option>';\n    if (warehouseId) {\n        const warehouseBins = binLocations.filter(b => b.warehouse_id == warehouseId);\n        warehouseBins.forEach(b => {\n            binSelect.innerHTML += `<option value=\"${b.id}\">${escapeHtml(b.bin_code)}${b.bin_name ? ' - ' + escapeHtml(b.bin_name) : ''}</option>`;\n        });\n    }\n}\nwindow.updateManagersAndBins = updateManagersAndBins;\n\nasync function handleStockTake(event) {\n    event.preventDefault();\n    \n    const btn = document.getElementById('stockTakeBtn');\n    const text = document.getElementById('stockTakeText');\n    const spinner = document.getElementById('stockTakeSpinner');\n    const result = document.getElementById('stockTakeResult');\n    \n    const formData = {\n        item_name: document.getElementById('stockItemName').value.trim(),\n        item_code: document.getElementById('stockItemCode').value.trim() || null,\n        quantity: parseInt(document.getElementById('stockQuantity').value) || 0,\n        company_id: parseInt(document.getElementById('stockCompany').value),\n        warehouse_id: parseInt(document.getElementById('stockWarehouse').value),\n        counted_by_manager_id: parseInt(document.getElementById('stockManager').value),\n        bin_location_id: document.getElementById('stockBinLocation').value ? parseInt(document.getElementById('stockBinLocation').value) : null,\n        date: document.getElementById('stockDate').value || null,\n        notes: document.getElementById('stockNotes').value.trim() || null,\n    };\n    \n    btn.disabled = true;\n    text.style.display = 'none';\n    spinner.style.display = 'inline';\n    result.style.display = 'none';\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/items`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(formData)\n        });\n        \n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Failed to add item');\n        }\n        \n        result.style.display = 'block';\n        result.className = 'result-message success';\n        result.textContent = `‚úÖ Successfully added item \"${formData.item_name}\"!`;\n        \n        document.getElementById('stockTakeForm').reset();\n        document.getElementById('stockDate').value = new Date().toISOString().split('T')[0];\n        \n    } catch (error) {\n        result.style.display = 'block';\n        result.className = 'result-message error';\n        result.textContent = `‚ùå Error: ${error.message}`;\n    } finally {\n        btn.disabled = false;\n        text.style.display = 'inline';\n        spinner.style.display = 'none';\n    }\n}\nwindow.handleStockTake = handleStockTake;\n\n// ========== VIEW ITEMS ==========\nasync function loadItems() {\n    const loadingEl = document.getElementById('viewItemsLoading');\n    const itemsListEl = document.getElementById('viewItemsList');\n    const noItemsEl = document.getElementById('viewItemsEmpty');\n    \n    if (loadingEl) loadingEl.style.display = 'block';\n    if (noItemsEl) noItemsEl.style.display = 'none';\n    if (itemsListEl) itemsListEl.innerHTML = '';\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/items`);\n        if (!response.ok) throw new Error(`Server error: ${response.status}`);\n        \n        allItems = await response.json();\n        \n        // Apply filters\n        applyViewFilters();\n        \n    } catch (error) {\n        console.error('Error loading items:', error);\n        showToast('Error loading items: ' + error.message, 'error', 5000);\n        if (itemsListEl) itemsListEl.innerHTML = '<div class=\"error-message\">Failed to load items. Please try again.</div>';\n    } finally {\n        if (loadingEl) loadingEl.style.display = 'none';\n    }\n}\nwindow.loadItems = loadItems;\n\nfunction applyViewFilters() {\n    const companyFilter = document.getElementById('viewCompanyFilter')?.value || '';\n    const warehouseFilter = document.getElementById('viewWarehouseFilter')?.value || '';\n    const searchTerm = document.getElementById('viewItemsSearch')?.value.toLowerCase().trim() || '';\n    \n    let filtered = [...allItems];\n    \n    // Filter by company\n    if (companyFilter) {\n        filtered = filtered.filter(item => item.company_id == companyFilter);\n    }\n    \n    // Filter by warehouse\n    if (warehouseFilter) {\n        filtered = filtered.filter(item => item.warehouse_id == warehouseFilter);\n    }\n    \n    // Filter by search term\n    if (searchTerm) {\n        filtered = filtered.filter(item => \n            (item.item_code && item.item_code.toLowerCase().includes(searchTerm)) ||\n            (item.item_name && item.item_name.toLowerCase().includes(searchTerm))\n        );\n    }\n    \n    displayViewItems(filtered);\n}\nwindow.applyViewFilters = applyViewFilters;\n\nfunction displayViewItems(items) {\n    const itemsListEl = document.getElementById('viewItemsList');\n    const noItemsEl = document.getElementById('viewItemsEmpty');\n    \n    if (!itemsListEl) return;\n    \n    if (items.length === 0) {\n        itemsListEl.innerHTML = '';\n        if (noItemsEl) noItemsEl.style.display = 'block';\n        return;\n    }\n    \n    if (noItemsEl) noItemsEl.style.display = 'none';\n    \n    // Get company and warehouse names for display\n    const getCompanyName = (id) => {\n        const company = companies.find(c => c.id == id);\n        return company ? company.company_name : `Company ${id}`;\n    };\n    \n    const getWarehouseName = (id) => {\n        const warehouse = warehouses.find(w => w.id == id);\n        return warehouse ? warehouse.warehouse_name : `Warehouse ${id}`;\n    };\n    \n    const getBinLocationCode = (id) => {\n        if (!id) return 'N/A';\n        const bin = binLocations.find(b => b.id == id);\n        return bin ? bin.bin_code : `Bin ${id}`;\n    };\n    \n    // Create table header\n    const tableHTML = `\n        <table class=\"view-items-table\">\n            <thead>\n                <tr>\n                    <th>Item Name</th>\n                    <th>Item Code</th>\n                    <th>Quantity</th>\n                    <th>Company</th>\n                    <th>Warehouse</th>\n                    <th>Bin Location</th>\n                    <th>Date</th>\n                    <th>Actions</th>\n                </tr>\n            </thead>\n            <tbody>\n                ${items.map(item => `\n                    <tr class=\"view-item-row\">\n                        <td class=\"view-item-name-cell\">\n                            <div class=\"item-name-text\">${escapeHtml(item.item_name || 'Unnamed Item')}</div>\n                            ${item.notes ? `<div class=\"item-notes-text\">${escapeHtml(item.notes)}</div>` : ''}\n                        </td>\n                        <td class=\"view-item-code-cell\">${item.item_code ? escapeHtml(item.item_code) : '‚Äî'}</td>\n                        <td class=\"view-item-quantity-cell\">\n                            <span class=\"quantity-badge\">${item.quantity || 0}</span>\n                        </td>\n                        <td class=\"view-item-company-cell\">${escapeHtml(getCompanyName(item.company_id))}</td>\n                        <td class=\"view-item-warehouse-cell\">${escapeHtml(getWarehouseName(item.warehouse_id))}</td>\n                        <td class=\"view-item-bin-cell\">${item.bin_location_id ? escapeHtml(getBinLocationCode(item.bin_location_id)) : '‚Äî'}</td>\n                        <td class=\"view-item-date-cell\">${item.date ? escapeHtml(item.date) : '‚Äî'}</td>\n                        <td class=\"view-item-actions-cell\">\n                            <button onclick=\"openEditItemModal(${item.id})\" class=\"btn btn-tiny btn-secondary\">Edit</button>\n                            <button onclick=\"deleteItem(${item.id})\" class=\"btn btn-tiny btn-danger\">Delete</button>\n                        </td>\n                    </tr>\n                `).join('')}\n            </tbody>\n        </table>\n    `;\n    \n    itemsListEl.innerHTML = tableHTML;\n}\n\nfunction updateViewFilters() {\n    // Update warehouse filter\n    const warehouseFilter = document.getElementById('viewWarehouseFilter');\n    if (warehouseFilter) {\n        const currentValue = warehouseFilter.value;\n        warehouseFilter.innerHTML = '<option value=\"\">All Warehouses</option>' + \n            warehouses.map(w => `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`).join('');\n        if (currentValue) warehouseFilter.value = currentValue;\n    }\n    \n    // Update manager filter\n    const managerFilter = document.getElementById('viewManagerFilter');\n    if (managerFilter) {\n        const currentValue = managerFilter.value;\n        managerFilter.innerHTML = '<option value=\"\">All Managers</option>' + \n            managers.map(m => `<option value=\"${m.id}\">${escapeHtml(m.manager_name)}</option>`).join('');\n        if (currentValue) managerFilter.value = currentValue;\n    }\n}\n\nfunction displayItems(items) {\n    const itemsListEl = document.getElementById('stockItemsList');\n    const noItemsEl = document.getElementById('noStockItems');\n    \n    if (!itemsListEl) return;\n    \n    if (items.length === 0) {\n        itemsListEl.innerHTML = '';\n        if (noItemsEl) noItemsEl.style.display = 'block';\n        return;\n    }\n    \n    if (noItemsEl) noItemsEl.style.display = 'none';\n    \n    itemsListEl.innerHTML = items.map(item => `\n        <div class=\"item-card\">\n            <div class=\"item-header\">\n                <h3>${escapeHtml(item.item_name || 'Unnamed Item')}</h3>\n                <span class=\"item-id\">ID: ${item.id}</span>\n            </div>\n            <div class=\"item-details\">\n                <div class=\"detail-item\">\n                    <strong>Quantity:</strong> <span class=\"quantity-badge\">${item.quantity || 0}</span>\n                </div>\n                ${item.item_code ? `<div class=\"detail-item\"><strong>Item Code:</strong> ${escapeHtml(item.item_code)}</div>` : ''}\n                <div class=\"detail-item\"><strong>Company:</strong> ${escapeHtml(item.company_name || 'N/A')}</div>\n                <div class=\"detail-item\"><strong>Warehouse:</strong> ${escapeHtml(item.warehouse_name || 'N/A')}</div>\n                ${item.bin_location_code ? `<div class=\"detail-item\"><strong>Bin Location:</strong> ${escapeHtml(item.bin_location_code)}</div>` : ''}\n                ${item.counted_by ? `<div class=\"detail-item\"><strong>Counted By:</strong> ${escapeHtml(item.counted_by)}</div>` : ''}\n                ${item.date ? `<div class=\"detail-item\"><strong>Date:</strong> ${escapeHtml(item.date)}</div>` : ''}\n                ${item.notes ? `<div class=\"detail-item\"><strong>Notes:</strong> ${escapeHtml(item.notes)}</div>` : ''}\n                ${item.created_at ? `<div class=\"detail-item\"><strong>Added:</strong> ${formatDate(item.created_at)}</div>` : ''}\n            </div>\n        </div>\n    `).join('');\n}\n\nfunction handleStockSearch() {\n    loadItems(); // Reload with search term\n}\nwindow.handleStockSearch = handleStockSearch;\n\nfunction openEditItemModal(itemId) {\n    const item = allItems.find(i => i.id === itemId);\n    if (!item) return;\n    \n    document.getElementById('editItemId').value = item.id;\n    document.getElementById('editItemName').value = item.item_name || '';\n    document.getElementById('editItemCode').value = item.item_code || '';\n    document.getElementById('editQuantity').value = item.quantity || 0;\n    \n    document.getElementById('editItemModal').style.display = 'flex';\n}\nwindow.openEditItemModal = openEditItemModal;\n\nfunction closeEditItemModal() {\n    document.getElementById('editItemModal').style.display = 'none';\n}\nwindow.closeEditItemModal = closeEditItemModal;\n\nasync function handleUpdateItem(event) {\n    event.preventDefault();\n    \n    const itemId = document.getElementById('editItemId').value;\n    const formData = {\n        item_name: document.getElementById('editItemName').value.trim(),\n        item_code: document.getElementById('editItemCode').value.trim() || null,\n        quantity: parseInt(document.getElementById('editQuantity').value) || 0,\n    };\n    \n    // Get existing item to preserve other fields\n    const existing = allItems.find(i => i.id == itemId);\n    if (existing) {\n        formData.company_id = existing.company_id;\n        formData.warehouse_id = existing.warehouse_id;\n        formData.bin_location_id = existing.bin_location_id;\n        formData.counted_by_manager_id = existing.counted_by_manager_id;\n        formData.date = existing.date;\n        formData.notes = existing.notes;\n    }\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/items/${itemId}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(formData)\n        });\n        \n        if (!response.ok) throw new Error('Failed to update item');\n        \n        showToast('Item updated successfully!', 'success', 3000);\n        closeEditItemModal();\n        loadItems();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nconst editItemForm = document.getElementById('editItemForm');\nif (editItemForm) {\n    editItemForm.onsubmit = handleUpdateItem;\n}\n\nasync function deleteItem(itemId) {\n    if (!confirm('Are you sure you want to delete this item?')) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/items/${itemId}`, { method: 'DELETE' });\n        if (!response.ok) throw new Error('Failed to delete item');\n        showToast('Item deleted successfully!', 'success', 3000);\n        loadItems();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.deleteItem = deleteItem;\n\n// ========== NEW STOCK TAKE WORKFLOW ==========\n// Note: currentStockTake, currentBinLocation, and currentBinItems are already declared at the top of the file\n\nasync function checkActiveStockTake() {\n    // This will be called when stock take tab is opened\n    // Ensure variables are initialized\n    if (typeof currentStockTake === 'undefined') {\n        currentStockTake = null;\n    }\n    // Status will be updated by updateStockTakeStatus() when tab is shown\n}\n\nfunction updateWarehousesForOpenStockTake() {\n    const companyId = document.getElementById('openStockTakeCompany').value;\n    const warehouseSelect = document.getElementById('openStockTakeWarehouse');\n    \n    warehouseSelect.innerHTML = '<option value=\"\">Select Warehouse</option>';\n    if (companyId) {\n        const companyWarehouses = warehouses.filter(w => w.company_id == companyId);\n        companyWarehouses.forEach(w => {\n            warehouseSelect.innerHTML += `<option value=\"${w.id}\">${escapeHtml(w.warehouse_name)}</option>`;\n        });\n    }\n    \n    // Clear validation message\n    const validationMsg = document.getElementById('managerValidationMessage');\n    if (validationMsg) {\n        validationMsg.style.display = 'none';\n    }\n}\nwindow.updateWarehousesForOpenStockTake = updateWarehousesForOpenStockTake;\n\nfunction validateManagerForWarehouse() {\n    const warehouseId = document.getElementById('openStockTakeWarehouse').value;\n    const validationMsg = document.getElementById('managerValidationMessage');\n    \n    if (!validationMsg) return;\n    \n    if (!warehouseId) {\n        validationMsg.style.display = 'none';\n        return;\n    }\n    \n    // Check if there are any managers for this warehouse\n    const warehouseManagers = managers.filter(m => m.warehouse_id == warehouseId && m.is_active !== 0);\n    \n    if (warehouseManagers.length === 0) {\n        validationMsg.style.display = 'block';\n        validationMsg.className = 'validation-message error';\n        validationMsg.innerHTML = '‚ö†Ô∏è No active managers found for this warehouse. Please add a manager in Setup before opening a stock take.';\n    } else {\n        validationMsg.style.display = 'block';\n        validationMsg.className = 'validation-message success';\n        validationMsg.innerHTML = `‚úÖ ${warehouseManagers.length} manager(s) available for this warehouse: ${warehouseManagers.map(m => escapeHtml(m.manager_name)).join(', ')}`;\n    }\n}\nwindow.validateManagerForWarehouse = validateManagerForWarehouse;\n\nasync function openStockTake() {\n    const companyId = document.getElementById('openStockTakeCompany').value;\n    const warehouseId = document.getElementById('openStockTakeWarehouse').value;\n    \n    if (!companyId || !warehouseId) {\n        showToast('Please select Company and Warehouse', 'warning', 3000);\n        return;\n    }\n    \n    // Validate that at least one manager exists for this warehouse\n    const warehouseManagers = managers.filter(m => m.warehouse_id == warehouseId && m.is_active !== 0);\n    \n    if (warehouseManagers.length === 0) {\n        showToast('Cannot open stock take: No active managers found for this warehouse. Please add a manager in Setup first.', 'error', 6000);\n        return;\n    }\n    \n    // Use the first active manager (or you could let the user choose later)\n    const managerId = warehouseManagers[0].id;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/stock-takes`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                company_id: parseInt(companyId),\n                warehouse_id: parseInt(warehouseId),\n                opened_by_manager_id: managerId\n            })\n        });\n        \n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Failed to open stock take');\n        }\n        \n        const data = await response.json();\n        currentStockTake = data.stockTake;\n        \n        updateStockTakeStatus();\n        \n        // Notify user and refresh open stock takes list if visible\n        alert(`‚úÖ Stock take opened successfully!\\n\\nManager: ${warehouseManagers[0].manager_name}\\n\\nStock Take ID: ${currentStockTake.id}`);\n        \n        // If on open stock takes tab, refresh the list\n        if (document.getElementById('openStockTakesTab')?.classList.contains('active')) {\n            loadOpenStockTakes();\n        }\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.openStockTake = openStockTake;\n\nasync function closeStockTake() {\n    if (!currentStockTake || !confirm('Are you sure you want to close this stock take?')) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/stock-takes/${currentStockTake.id}/close`, {\n            method: 'PUT'\n        });\n        \n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Failed to close stock take');\n        }\n        \n        currentStockTake = null;\n        currentBinLocation = null;\n        currentBinItems = [];\n        \n        updateStockTakeStatus();\n        clearBinLocation();\n        alert('‚úÖ Stock take closed successfully!');\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.closeStockTake = closeStockTake;\n\nfunction updateStockTakeStatus() {\n    // Ensure currentStockTake is defined (should always be, but check for safety)\n    if (typeof currentStockTake === 'undefined') {\n        currentStockTake = null;\n    }\n    \n    const statusBox = document.getElementById('stockTakeStatus');\n    const openBtn = document.getElementById('openStockTakeBtn');\n    const closeBtn = document.getElementById('closeStockTakeBtn');\n    const binSection = document.getElementById('binLocationSection');\n    const itemSection = document.getElementById('itemScanSection');\n    const binItemsSection = document.getElementById('binItemsSection');\n    \n    // Only update manager section if it exists (manager mode)\n    if (statusBox && openBtn && closeBtn) {\n        if (currentStockTake) {\n            statusBox.innerHTML = `\n                <p><strong>‚úÖ Stock Take Open</strong></p>\n                <p>Company: ${escapeHtml(currentStockTake.company_name)}</p>\n                <p>Warehouse: ${escapeHtml(currentStockTake.warehouse_name)}</p>\n                <p>Opened: ${formatDate(currentStockTake.opened_at)}</p>\n            `;\n            statusBox.className = 'status-box success';\n            openBtn.style.display = 'none';\n            closeBtn.style.display = 'inline-block';\n        } else {\n            statusBox.innerHTML = '<p>No stock take open</p>';\n            statusBox.className = 'status-box';\n            openBtn.style.display = 'inline-block';\n            closeBtn.style.display = 'none';\n        }\n    }\n    \n    // Handle scanning sections visibility\n    if (currentStockTake) {\n        // Show scanning sections - ALWAYS show bin location section when stock take is open\n        if (binSection) {\n            binSection.style.display = 'block';\n            binSection.style.visibility = 'visible';\n        }\n        \n        // Scroll to bin location section to make it visible (manager mode)\n        if (currentRole === 'manager') {\n            setTimeout(() => {\n                if (binSection) {\n                    binSection.scrollIntoView({ behavior: 'smooth', block: 'start' });\n                }\n                // Focus on bin location input for immediate scanning\n                const binInput = document.getElementById('binLocationInput');\n                if (binInput) {\n                    binInput.focus();\n                    binInput.select();\n                }\n            }, 100);\n        }\n    } else {\n        // Hide scanning sections when no stock take\n        if (binSection) binSection.style.display = 'none';\n        if (itemSection) itemSection.style.display = 'none';\n        if (binItemsSection) binItemsSection.style.display = 'none';\n    }\n}\n\n// Counter mode: Scan bin location to start counting (requires open stock take)\nasync function handleCounterBinLocationScan() {\n    const binCode = document.getElementById('counterBinLocationInput').value.trim();\n    \n    if (!binCode) {\n        showToast('Please enter or scan a bin location code', 'warning', 3000);\n        return;\n    }\n    \n    try {\n        // First, lookup the bin location to get company/warehouse\n        const lookupResponse = await fetch(`${CONFIG.apiUrl}/bin-locations/lookup?bin_code=${encodeURIComponent(binCode)}`);\n        \n        if (!lookupResponse.ok) {\n            const error = await lookupResponse.json();\n            throw new Error(error.error || 'Bin location not found');\n        }\n        \n        const binLocation = await lookupResponse.json();\n        \n        console.log('Bin location found:', binLocation);\n        console.log('Bin location company_id:', binLocation.company_id, 'type:', typeof binLocation.company_id);\n        console.log('Bin location warehouse_id:', binLocation.warehouse_id, 'type:', typeof binLocation.warehouse_id);\n        \n        // Check if there's an open stock take for this warehouse/company\n        // Stock takes are opened at Company + Warehouse level, not bin location level\n        let stockTake = null;\n        try {\n        // Ensure we're using the correct IDs from the bin location\n        // Convert to integers to ensure proper comparison\n        const companyId = parseInt(binLocation.company_id);\n        const warehouseId = parseInt(binLocation.warehouse_id);\n        \n        console.log('Bin location data:', binLocation);\n        console.log('Checking for open stock take with company_id:', companyId, '(type:', typeof companyId, ')', 'warehouse_id:', warehouseId, '(type:', typeof warehouseId, ')');\n            \n            const stockTakeResponse = await fetch(`${CONFIG.apiUrl}/stock-takes/active?company_id=${companyId}&warehouse_id=${warehouseId}`);\n            \n            console.log('Stock take response status:', stockTakeResponse.status);\n            \n            if (stockTakeResponse.ok) {\n                const responseData = await stockTakeResponse.json();\n                console.log('Stock take response:', responseData);\n                \n                // Check if response has debug info (when no stock take found)\n                if (responseData.debug) {\n                    console.log('Debug info from server:', responseData.debug);\n                    stockTake = null;\n                    console.log('No matching stock take found. All open stock takes:', responseData.debug.all_open_stock_takes);\n                } else if (responseData.result === null) {\n                    stockTake = null;\n                    console.log('No stock take found (explicit null result)');\n                } else if (!responseData || responseData === null || (typeof responseData === 'object' && Object.keys(responseData).length === 0)) {\n                    stockTake = null;\n                    console.log('No stock take found (null or empty response)');\n                } else {\n                    // Use result if available, otherwise use responseData directly\n                    stockTake = responseData.result || responseData;\n                    console.log('Found stock take:', stockTake);\n                    console.log('Stock take company_id:', stockTake.company_id, 'type:', typeof stockTake.company_id);\n                    console.log('Stock take warehouse_id:', stockTake.warehouse_id, 'type:', typeof stockTake.warehouse_id);\n                }\n            } else if (stockTakeResponse.status === 404) {\n                // 404 means no stock take found - this is expected, not an error\n                stockTake = null;\n                console.log('No stock take found (404 response)');\n            } else {\n                // Other HTTP error - try to get error message\n                let errorMessage = 'Failed to check for open stock take';\n                try {\n                    const errorData = await stockTakeResponse.json();\n                    errorMessage = errorData.error || errorMessage;\n                    console.error('Error response:', errorData);\n                } catch (e) {\n                    errorMessage = `Server error (${stockTakeResponse.status}): ${stockTakeResponse.statusText}`;\n                }\n                throw new Error(errorMessage);\n            }\n        } catch (error) {\n            // If it's already our custom error, re-throw it\n            if (error.message.includes('Failed to check') || error.message.includes('Server error')) {\n                throw error;\n            }\n            // Network or other errors - show helpful message\n            console.error('Error checking for open stock take:', error);\n            throw new Error('Unable to connect to server. Please check your internet connection and try again.');\n        }\n        \n        // Counter can ONLY count against existing open stock takes\n        if (!stockTake) {\n            // Get debug info if available\n            let debugInfo = '';\n            try {\n                const debugResponse = await fetch(`${CONFIG.apiUrl}/stock-takes/active?company_id=${companyId}&warehouse_id=${warehouseId}`);\n                if (debugResponse.ok) {\n                    const debugData = await debugResponse.json();\n                    if (debugData.debug && debugData.debug.all_open_stock_takes) {\n                        debugInfo = `\\n\\nDebug: Found ${debugData.debug.all_open_stock_takes.length} open stock take(s) in database:\\n`;\n                        debugData.debug.all_open_stock_takes.forEach((st, idx) => {\n                            debugInfo += `${idx + 1}. ID: ${st.id}, Company ID: ${st.company_id}, Warehouse ID: ${st.warehouse_id}, Company: ${st.company_name || 'N/A'}, Warehouse: ${st.warehouse_name || 'N/A'}\\n`;\n                        });\n                        debugInfo += `\\nRequested: Company ID: ${companyId}, Warehouse ID: ${warehouseId}`;\n                    }\n                }\n            } catch (e) {\n                console.error('Error getting debug info:', e);\n            }\n            \n            throw new Error(`No open stock take found for this bin location.\\n\\nBin: ${binLocation.bin_code}\\nWarehouse: ${binLocation.warehouse_name} (ID: ${warehouseId})\\nCompany: ${binLocation.company_name} (ID: ${companyId})\\n\\nPlease ask a manager to open a stock take for this Company and Warehouse combination first.${debugInfo}`);\n        }\n        \n        // Verify bin location belongs to the stock take's warehouse/company\n        // Use loose comparison to handle string/number mismatches\n        const binCompanyId = parseInt(binLocation.company_id);\n        const binWarehouseId = parseInt(binLocation.warehouse_id);\n        const stockTakeCompanyId = parseInt(stockTake.company_id);\n        const stockTakeWarehouseId = parseInt(stockTake.warehouse_id);\n        \n        console.log('Comparing IDs - Bin:', binCompanyId, binWarehouseId, 'Stock Take:', stockTakeCompanyId, stockTakeWarehouseId);\n        \n        if (binCompanyId !== stockTakeCompanyId || binWarehouseId !== stockTakeWarehouseId) {\n            throw new Error(`Bin location does not match the open stock take.\\n\\nBin: ${binLocation.bin_code}\\nBin Company ID: ${binCompanyId}, Warehouse ID: ${binWarehouseId}\\nStock Take Company ID: ${stockTakeCompanyId}, Warehouse ID: ${stockTakeWarehouseId}\\n\\nPlease scan a bin from the correct warehouse.`);\n        }\n        \n        // Set current stock take and bin location\n        currentStockTake = stockTake;\n        currentBinLocation = binLocation;\n        \n        // Update UI\n        updateStockTakeStatus();\n        \n        // Show bin location info\n        document.getElementById('currentBinCode').textContent = binLocation.bin_code;\n        document.getElementById('currentBinInfo').textContent = `${binLocation.warehouse_name} - ${binLocation.company_name}`;\n        document.getElementById('currentBinLocation').style.display = 'block';\n        document.getElementById('clearBinBtn').style.display = 'inline-block';\n        \n        // Hide counter start section, show scanning sections\n        document.getElementById('counterStartSection').style.display = 'none';\n        document.getElementById('binLocationSection').style.display = 'block';\n        \n        // Show item scan section and bin items section\n        const itemSection = document.getElementById('itemScanSection');\n        const binItemsSection = document.getElementById('binItemsSection');\n        if (itemSection) itemSection.style.display = 'block';\n        if (binItemsSection) binItemsSection.style.display = 'block';\n        \n        // Scroll to item scan section\n        setTimeout(() => {\n            if (itemSection) {\n                itemSection.scrollIntoView({ behavior: 'smooth', block: 'start' });\n                // Focus on item code input\n                const itemCodeInput = document.getElementById('itemCodeInput');\n                if (itemCodeInput) itemCodeInput.focus();\n            }\n        }, 300);\n        \n        // Load items for this bin\n        loadBinItems();\n        \n        // Clear counter bin location input\n        document.getElementById('counterBinLocationInput').value = '';\n        \n        // Show success toast\n        showToast(`Started counting bin location: ${binLocation.bin_code}`, 'success', 3000);\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n        // Keep focus on input for retry\n        setTimeout(() => {\n            const counterBinInput = document.getElementById('counterBinLocationInput');\n            if (counterBinInput) counterBinInput.focus();\n        }, 100);\n    }\n}\nwindow.handleCounterBinLocationScan = handleCounterBinLocationScan;\n\n// Manager mode: Scan bin location (requires stock take to be open first)\nasync function handleBinLocationScan() {\n    const binCode = document.getElementById('binLocationInput').value.trim();\n    \n    if (!binCode) {\n        showToast('Please enter or scan a bin location code', 'warning', 3000);\n        return;\n    }\n    \n    if (!currentStockTake) {\n        showToast('Please open a stock take first', 'warning', 3000);\n        return;\n    }\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/bin-locations/lookup?bin_code=${encodeURIComponent(binCode)}&stock_take_id=${currentStockTake.id}`);\n        \n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Bin location not found or invalid');\n        }\n        \n        const binLocation = await response.json();\n        currentBinLocation = binLocation;\n        \n        // Show bin location info\n        document.getElementById('currentBinCode').textContent = binLocation.bin_code;\n        document.getElementById('currentBinInfo').textContent = `${binLocation.warehouse_name} - ${binLocation.company_name}`;\n        document.getElementById('currentBinLocation').style.display = 'block';\n        document.getElementById('clearBinBtn').style.display = 'inline-block';\n        \n        // Show item scan section and bin items section\n        const itemSection = document.getElementById('itemScanSection');\n        const binItemsSection = document.getElementById('binItemsSection');\n        if (itemSection) itemSection.style.display = 'block';\n        if (binItemsSection) binItemsSection.style.display = 'block';\n        \n        // Scroll to item scan section\n        setTimeout(() => {\n            if (itemSection) {\n                itemSection.scrollIntoView({ behavior: 'smooth', block: 'start' });\n                // Focus on item code input\n                const itemCodeInput = document.getElementById('itemCodeInput');\n                if (itemCodeInput) itemCodeInput.focus();\n            }\n        }, 300);\n        \n        // Load items for this bin\n        loadBinItems();\n        \n        // Clear bin location input\n        document.getElementById('binLocationInput').value = '';\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.handleBinLocationScan = handleBinLocationScan;\n\nfunction clearBinLocation() {\n    if (confirm('Clear current bin location? All unsaved items will be lost.')) {\n        currentBinLocation = null;\n        currentBinItems = [];\n        \n        document.getElementById('currentBinLocation').style.display = 'none';\n        document.getElementById('clearBinBtn').style.display = 'none';\n        document.getElementById('itemScanSection').style.display = 'none';\n        document.getElementById('binItemsSection').style.display = 'none';\n        document.getElementById('binItemsList').innerHTML = '';\n        document.getElementById('itemCodeInput').value = '';\n        document.getElementById('itemNameInput').value = '';\n        document.getElementById('itemQuantityInput').value = '0';\n    }\n}\nwindow.clearBinLocation = clearBinLocation;\n\nasync function handleItemCodeScan() {\n    const itemCode = document.getElementById('itemCodeInput').value.trim();\n    \n    if (!itemCode) {\n        showToast('Please enter or scan an item code', 'warning', 3000);\n        return;\n    }\n    \n    // Lookup item in catalog\n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/items-catalog?stock_code=${encodeURIComponent(itemCode)}`);\n        \n        if (response.ok) {\n            const item = await response.json();\n            // Auto-populate item name\n            const itemNameInput = document.getElementById('itemNameInput');\n            if (itemNameInput && item.item_name) {\n                itemNameInput.value = item.item_name;\n            }\n            \n            // Show serial number requirement if needed\n            if (item.requires_serial_number) {\n                showToast('‚ö†Ô∏è This item requires a serial number', 'warning', 4000);\n            }\n        } else if (response.status === 404) {\n            // Item not found in catalog - allow manual entry\n            console.log('Item not found in catalog, allowing manual entry');\n            const itemNameInput = document.getElementById('itemNameInput');\n            if (itemNameInput) {\n                itemNameInput.focus();\n            }\n        } else {\n            throw new Error('Failed to lookup item');\n        }\n    } catch (error) {\n        console.error('Error looking up item:', error);\n        // Continue anyway - allow manual entry\n    }\n    \n    // Auto-focus on quantity input and open number pad\n    setTimeout(() => {\n        const quantityInput = document.getElementById('itemQuantityInput');\n        if (quantityInput) {\n            quantityInput.focus();\n            quantityInput.select();\n            // Trigger click to open number pad on mobile\n            quantityInput.click();\n        }\n    }, 100);\n}\nwindow.handleItemCodeScan = handleItemCodeScan;\n\n// Allow Enter key on item code to trigger lookup and move to quantity\ndocument.getElementById('itemCodeInput')?.addEventListener('keypress', function(e) {\n    if (e.key === 'Enter') {\n        e.preventDefault();\n        handleItemCodeScan();\n    }\n});\n\n// Clear item name when item code input changes\ndocument.getElementById('itemCodeInput')?.addEventListener('input', function(e) {\n    const itemNameInput = document.getElementById('itemNameInput');\n    if (itemNameInput && !itemNameInput.value) {\n        // Only clear if it's empty (don't clear if user manually entered something)\n        itemNameInput.value = '';\n    }\n});\n\nasync function addItemToBin() {\n    if (!currentStockTake || !currentBinLocation) {\n        showToast('Please scan a bin location first', 'warning', 3000);\n        return;\n    }\n    \n    const itemCode = document.getElementById('itemCodeInput').value.trim();\n    const itemName = document.getElementById('itemNameInput').value.trim();\n    const quantity = parseInt(document.getElementById('itemQuantityInput').value) || 0;\n    \n    if (!itemCode) {\n        showToast('Please enter or scan an item code', 'warning', 3000);\n        return;\n    }\n    \n    if (quantity < 0) {\n        showToast('Quantity must be 0 or greater', 'warning', 3000);\n        return;\n    }\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/bin-location-counts`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                stock_take_id: currentStockTake.id,\n                bin_location_id: currentBinLocation.id,\n                item_code: itemCode,\n                item_name: itemName || null,\n                quantity: quantity,\n                counted_by_manager_id: currentStockTake.opened_by_manager_id\n            })\n        });\n        \n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Failed to add item');\n        }\n        \n        // Clear inputs\n        document.getElementById('itemCodeInput').value = '';\n        document.getElementById('itemNameInput').value = '';\n        document.getElementById('itemQuantityInput').value = '1';\n        \n        // Reload bin items\n        loadBinItems();\n        \n        // Automatically launch QR scanner for next item\n        setTimeout(() => {\n            const itemCodeInput = document.getElementById('itemCodeInput');\n            if (itemCodeInput) {\n                startQRScan('itemCodeInput', handleItemCodeScan);\n            }\n        }, 300);\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.addItemToBin = addItemToBin;\n\nasync function loadBinItems() {\n    if (!currentStockTake || !currentBinLocation) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/bin-location-counts?stock_take_id=${currentStockTake.id}&bin_location_id=${currentBinLocation.id}&submitted=0`);\n        \n        if (!response.ok) throw new Error('Failed to load bin items');\n        \n        currentBinItems = await response.json();\n        \n        const listEl = document.getElementById('binItemsList');\n        const noItemsEl = document.getElementById('noBinItems');\n        \n        if (currentBinItems.length === 0) {\n            listEl.innerHTML = '';\n            noItemsEl.style.display = 'block';\n        } else {\n            noItemsEl.style.display = 'none';\n            listEl.innerHTML = currentBinItems.map(item => `\n                <div class=\"item-card\">\n                    <div class=\"item-header\">\n                        <h3>${escapeHtml(item.item_code)}</h3>\n                        <span class=\"quantity-badge\">Qty: ${item.quantity}</span>\n                    </div>\n                    ${item.item_name ? `<div class=\"item-details\"><div class=\"detail-item\"><strong>Name:</strong> ${escapeHtml(item.item_name)}</div></div>` : ''}\n                    <div class=\"item-actions\">\n                        <button onclick=\"removeBinItem(${item.id})\" class=\"btn btn-small btn-danger\">Remove</button>\n                    </div>\n                </div>\n            `).join('');\n        }\n    } catch (error) {\n        console.error('Error loading bin items:', error);\n    }\n}\nwindow.loadBinItems = loadBinItems;\n\nasync function removeBinItem(itemId) {\n    if (!confirm('Remove this item from the bin?')) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/bin-location-counts/${itemId}`, {\n            method: 'DELETE'\n        });\n        \n        if (!response.ok) throw new Error('Failed to remove item');\n        \n        loadBinItems();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.removeBinItem = removeBinItem;\n\nfunction clearBinItems() {\n    if (!confirm('Clear all items from current bin? This cannot be undone.')) return;\n    \n    // Delete all unsubmitted items for this bin\n    Promise.all(currentBinItems.map(item => \n        fetch(`${CONFIG.apiUrl}/bin-location-counts/${item.id}`, { method: 'DELETE' })\n    )).then(() => {\n        loadBinItems();\n    }).catch(error => {\n        showToast('Error clearing items: ' + error.message, 'error', 5000);\n    });\n}\nwindow.clearBinItems = clearBinItems;\n\nasync function submitBinLocation() {\n    if (!currentStockTake || !currentBinLocation) {\n        showToast('Please scan a bin location first', 'warning', 3000);\n        return;\n    }\n    \n    if (currentBinItems.length === 0) {\n        showToast('Please add at least one item before submitting', 'warning', 3000);\n        return;\n    }\n    \n    if (!confirm(`Submit ${currentBinItems.length} item(s) for bin location ${currentBinLocation.bin_code}?`)) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/bin-location-counts/${currentBinLocation.id}/submit`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                stock_take_id: currentStockTake.id,\n                counted_by_manager_id: currentStockTake.opened_by_manager_id\n            })\n        });\n        \n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Failed to submit bin location');\n        }\n        \n        const data = await response.json();\n        showToast(`Successfully submitted ${data.items_submitted} item(s) for bin location ${currentBinLocation.bin_code}!`, 'success', 4000);\n        \n        // Clear bin location and items\n        clearBinLocation();\n        \n        // Reload items in view tab\n        if (document.getElementById('viewTab').classList.contains('active')) {\n            loadItems();\n        }\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.submitBinLocation = submitBinLocation;\n\n// Check for active stock take when switching to stock take tab\nconst originalShowTab = showTab;\nshowTab = function(tabName, clickedElement) {\n    originalShowTab(tabName, clickedElement);\n    \n    if (tabName === 'stocktake') {\n        // Ensure variables are initialized\n        if (typeof currentStockTake === 'undefined') {\n            currentStockTake = null;\n        }\n        \n        // Update status display\n        updateStockTakeStatus();\n        \n        // Try to load active stock take if we have company/warehouse selected\n        const companyId = document.getElementById('openStockTakeCompany')?.value;\n        const warehouseId = document.getElementById('openStockTakeWarehouse')?.value;\n        \n        if (companyId && warehouseId) {\n            loadActiveStockTake(companyId, warehouseId);\n        }\n    }\n};\n\nasync function loadActiveStockTake(companyId, warehouseId) {\n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/stock-takes/active?company_id=${companyId}&warehouse_id=${warehouseId}`);\n        \n        if (response.ok) {\n            const stockTake = await response.json();\n            if (stockTake) {\n                currentStockTake = stockTake;\n                updateStockTakeStatus();\n            }\n        }\n    } catch (error) {\n        console.error('Error loading active stock take:', error);\n    }\n}\n\n// ========== SYSTEM ADMIN ==========\n// ADMIN_PASSWORD is defined at the top of the file\n\nfunction isAdminAuthenticated() {\n    return sessionStorage.getItem('adminAuthenticated') === 'true';\n}\n\nfunction checkAdminPassword() {\n    console.log('=== checkAdminPassword called ===');\n    \n    const passwordInput = document.getElementById('adminPassword');\n    const errorDiv = document.getElementById('adminPasswordError');\n    \n    if (!passwordInput) {\n        console.error('adminPassword input not found');\n        alert('Password input not found. Please refresh the page.');\n        return false;\n    }\n    \n    const password = passwordInput.value.trim();\n    console.log('Password entered:', password);\n    console.log('Password length:', password.length);\n    console.log('Expected password:', ADMIN_PASSWORD);\n    console.log('Expected length:', ADMIN_PASSWORD.length);\n    console.log('Passwords match:', password === ADMIN_PASSWORD);\n    \n    if (password === ADMIN_PASSWORD) {\n        console.log('‚úì Password correct, granting access');\n        sessionStorage.setItem('adminAuthenticated', 'true');\n        \n        // Hide login form and show admin content\n        const loginDiv = document.getElementById('systemAdminLogin');\n        const contentDiv = document.getElementById('systemAdminContent');\n        \n        console.log('Login div found:', !!loginDiv);\n        console.log('Content div found:', !!contentDiv);\n        \n        if (loginDiv) {\n            loginDiv.style.display = 'none';\n            console.log('Login div hidden');\n        }\n        if (contentDiv) {\n            contentDiv.style.display = 'block';\n            console.log('Content div shown');\n        }\n        \n        if (errorDiv) errorDiv.style.display = 'none';\n        passwordInput.value = '';\n        \n        // Load admin data\n        showAdminContent();\n        \n        showToast('Admin access granted', 'success', 2000);\n        return true;\n    } else {\n        console.log('‚úó Password incorrect');\n        console.log('Entered:', JSON.stringify(password));\n        console.log('Expected:', JSON.stringify(ADMIN_PASSWORD));\n        if (errorDiv) {\n            errorDiv.textContent = 'Incorrect password. Please try again.';\n            errorDiv.style.display = 'block';\n        }\n        passwordInput.value = '';\n        setTimeout(() => {\n            if (passwordInput) passwordInput.focus();\n        }, 100);\n        showToast('Incorrect password', 'error', 3000);\n        return false;\n    }\n}\nwindow.checkAdminPassword = checkAdminPassword;\n\nfunction showAdminLogin() {\n    const loginDiv = document.getElementById('systemAdminLogin');\n    const contentDiv = document.getElementById('systemAdminContent');\n    \n    if (loginDiv) loginDiv.style.display = 'block';\n    if (contentDiv) contentDiv.style.display = 'none';\n}\n\nfunction showAdminContent() {\n    const loginDiv = document.getElementById('systemAdminLogin');\n    const contentDiv = document.getElementById('systemAdminContent');\n    \n    if (loginDiv) loginDiv.style.display = 'none';\n    if (contentDiv) contentDiv.style.display = 'block';\n    \n    // Load data\n    loadManagerCompanyAccess();\n    loadCounterCompanyAccess();\n    if (managers.length === 0) loadManagers();\n    if (companies.length === 0) loadCompanies();\n}\n\n// Manager-Company Access Management\nasync function loadManagerCompanyAccess() {\n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/manager-company-access`);\n        \n        let accessList = [];\n        if (response.ok) {\n            accessList = await response.json();\n        } else if (response.status === 404) {\n            accessList = [];\n        } else {\n            throw new Error('Failed to load manager-company access');\n        }\n        \n        const managerFilter = document.getElementById('adminManagerFilter');\n        if (managerFilter && managers.length > 0) {\n            const currentValue = managerFilter.value;\n            managerFilter.innerHTML = '<option value=\"\">All Managers</option>' + \n                managers.map(m => `<option value=\"${m.id}\">${escapeHtml(m.manager_name)}</option>`).join('');\n            if (currentValue) managerFilter.value = currentValue;\n        }\n        \n        const filterValue = managerFilter?.value || '';\n        let filteredList = accessList;\n        if (filterValue) {\n            filteredList = accessList.filter(a => a.manager_id === parseInt(filterValue));\n        }\n        \n        const listEl = document.getElementById('managerCompanyAccessList');\n        const noItemsEl = document.getElementById('noManagerAccess');\n        \n        if (listEl) {\n            if (filteredList.length === 0) {\n                listEl.innerHTML = '';\n                if (noItemsEl) noItemsEl.style.display = 'block';\n            } else {\n                if (noItemsEl) noItemsEl.style.display = 'none';\n                listEl.innerHTML = filteredList.map(access => {\n                    const manager = managers.find(m => m.id === access.manager_id);\n                    const company = companies.find(c => c.id === access.company_id);\n                    return `\n                        <div class=\"item-card\">\n                            <div class=\"item-header\">\n                                <div>\n                                    <h3>${escapeHtml(manager ? manager.manager_name : 'Unknown Manager')}</h3>\n                                    <p style=\"color: var(--text-muted); font-size: 0.875rem; margin: 0.25rem 0 0 0;\">${escapeHtml(company ? company.company_name : 'Unknown Company')}</p>\n                                </div>\n                                <div class=\"item-actions\">\n                                    <button onclick=\"deleteManagerCompanyAccess(${access.id})\" class=\"btn btn-small btn-danger\">Delete</button>\n                                </div>\n                            </div>\n                        </div>\n                    `;\n                }).join('');\n            }\n        }\n    } catch (error) {\n        console.error('Error loading manager-company access:', error);\n        const listEl = document.getElementById('managerCompanyAccessList');\n        const noItemsEl = document.getElementById('noManagerAccess');\n        if (listEl) listEl.innerHTML = '';\n        if (noItemsEl) noItemsEl.style.display = 'block';\n    }\n}\nwindow.loadManagerCompanyAccess = loadManagerCompanyAccess;\n\nasync function loadCounterCompanyAccess() {\n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/counter-company-access`);\n        \n        let accessList = [];\n        if (response.ok) {\n            accessList = await response.json();\n        } else if (response.status === 404) {\n            accessList = [];\n        } else {\n            throw new Error('Failed to load counter-company access');\n        }\n        \n        const counterFilter = document.getElementById('adminCounterFilter');\n        const uniqueEmails = [...new Set(accessList.map(a => a.counter_email))];\n        if (counterFilter) {\n            const currentValue = counterFilter.value;\n            counterFilter.innerHTML = '<option value=\"\">All Counters</option>' + \n                uniqueEmails.map(email => `<option value=\"${email}\">${escapeHtml(email)}</option>`).join('');\n            if (currentValue) counterFilter.value = currentValue;\n        }\n        \n        const filterValue = counterFilter?.value || '';\n        let filteredList = accessList;\n        if (filterValue) {\n            filteredList = accessList.filter(a => a.counter_email === filterValue);\n        }\n        \n        const listEl = document.getElementById('counterCompanyAccessList');\n        const noItemsEl = document.getElementById('noCounterAccess');\n        \n        if (listEl) {\n            if (filteredList.length === 0) {\n                listEl.innerHTML = '';\n                if (noItemsEl) noItemsEl.style.display = 'block';\n            } else {\n                if (noItemsEl) noItemsEl.style.display = 'none';\n                listEl.innerHTML = filteredList.map(access => {\n                    const company = companies.find(c => c.id === access.company_id);\n                    return `\n                        <div class=\"item-card\">\n                            <div class=\"item-header\">\n                                <div>\n                                    <h3>${escapeHtml(access.counter_email)}</h3>\n                                    <p style=\"color: var(--text-muted); font-size: 0.875rem; margin: 0.25rem 0 0 0;\">${escapeHtml(company ? company.company_name : 'Unknown Company')}</p>\n                                </div>\n                                <div class=\"item-actions\">\n                                    <button onclick=\"deleteCounterCompanyAccess(${access.id})\" class=\"btn btn-small btn-danger\">Delete</button>\n                                </div>\n                            </div>\n                        </div>\n                    `;\n                }).join('');\n            }\n        }\n    } catch (error) {\n        console.error('Error loading counter-company access:', error);\n        const listEl = document.getElementById('counterCompanyAccessList');\n        const noItemsEl = document.getElementById('noCounterAccess');\n        if (listEl) listEl.innerHTML = '';\n        if (noItemsEl) noItemsEl.style.display = 'block';\n    }\n}\nwindow.loadCounterCompanyAccess = loadCounterCompanyAccess;\n\nfunction openAddManagerCompanyAccessModal() {\n    if (!isAdminAuthenticated()) {\n        showToast('Admin access required', 'error', 3000);\n        return;\n    }\n    \n    const modal = document.getElementById('managerCompanyAccessModal');\n    const form = document.getElementById('managerCompanyAccessForm');\n    const title = document.getElementById('managerCompanyAccessModalTitle');\n    const managerSelect = document.getElementById('accessManager');\n    const companySelect = document.getElementById('accessCompany');\n    \n    if (modal && form && title && managerSelect && companySelect) {\n        title.textContent = 'Add Manager-Company Access';\n        form.reset();\n        \n        const idField = document.getElementById('editManagerCompanyAccessId');\n        if (idField) idField.remove();\n        \n        managerSelect.innerHTML = '<option value=\"\">Select Manager</option>' + \n            managers.map(m => `<option value=\"${m.id}\">${escapeHtml(m.manager_name)}</option>`).join('');\n        \n        companySelect.innerHTML = '<option value=\"\">Select Company</option>' + \n            companies.map(c => `<option value=\"${c.id}\">${escapeHtml(c.company_name)}</option>`).join('');\n        \n        modal.style.display = 'flex';\n    }\n}\nwindow.openAddManagerCompanyAccessModal = openAddManagerCompanyAccessModal;\n\nfunction closeManagerCompanyAccessModal() {\n    const modal = document.getElementById('managerCompanyAccessModal');\n    if (modal) modal.style.display = 'none';\n}\nwindow.closeManagerCompanyAccessModal = closeManagerCompanyAccessModal;\n\nasync function handleManagerCompanyAccessSubmit(event) {\n    event.preventDefault();\n    if (!isAdminAuthenticated()) {\n        showToast('Admin access required', 'error', 3000);\n        return;\n    }\n    \n    const managerId = document.getElementById('accessManager')?.value;\n    const companyId = document.getElementById('accessCompany')?.value;\n    \n    if (!managerId || !companyId) {\n        showToast('Please select both manager and company', 'error', 3000);\n        return;\n    }\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/manager-company-access`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                manager_id: parseInt(managerId),\n                company_id: parseInt(companyId)\n            })\n        });\n        \n        if (!response.ok) {\n            if (response.status === 409) {\n                throw new Error('This access already exists');\n            }\n            throw new Error('Failed to save access');\n        }\n        \n        showToast('Access granted successfully!', 'success', 3000);\n        closeManagerCompanyAccessModal();\n        await loadManagerCompanyAccess();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.handleManagerCompanyAccessSubmit = handleManagerCompanyAccessSubmit;\n\nasync function deleteManagerCompanyAccess(id) {\n    if (!isAdminAuthenticated()) {\n        showToast('Admin access required', 'error', 3000);\n        return;\n    }\n    \n    if (!confirm('Are you sure you want to remove this access?')) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/manager-company-access/${id}`, {\n            method: 'DELETE'\n        });\n        \n        if (!response.ok) throw new Error('Failed to delete access');\n        \n        showToast('Access removed successfully!', 'success', 3000);\n        await loadManagerCompanyAccess();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.deleteManagerCompanyAccess = deleteManagerCompanyAccess;\n\nfunction openAddCounterCompanyAccessModal() {\n    if (!isAdminAuthenticated()) {\n        showToast('Admin access required', 'error', 3000);\n        return;\n    }\n    \n    const modal = document.getElementById('counterCompanyAccessModal');\n    const form = document.getElementById('counterCompanyAccessForm');\n    const title = document.getElementById('counterCompanyAccessModalTitle');\n    const companySelect = document.getElementById('accessCounterCompany');\n    \n    if (modal && form && title && companySelect) {\n        title.textContent = 'Add Counter-Company Access';\n        form.reset();\n        \n        const idField = document.getElementById('editCounterCompanyAccessId');\n        if (idField) idField.remove();\n        \n        companySelect.innerHTML = '<option value=\"\">Select Company</option>' + \n            companies.map(c => `<option value=\"${c.id}\">${escapeHtml(c.company_name)}</option>`).join('');\n        \n        modal.style.display = 'flex';\n    }\n}\nwindow.openAddCounterCompanyAccessModal = openAddCounterCompanyAccessModal;\n\nfunction closeCounterCompanyAccessModal() {\n    const modal = document.getElementById('counterCompanyAccessModal');\n    if (modal) modal.style.display = 'none';\n}\nwindow.closeCounterCompanyAccessModal = closeCounterCompanyAccessModal;\n\nasync function handleCounterCompanyAccessSubmit(event) {\n    event.preventDefault();\n    if (!isAdminAuthenticated()) {\n        showToast('Admin access required', 'error', 3000);\n        return;\n    }\n    \n    const counterEmail = document.getElementById('accessCounterEmail')?.value.trim();\n    const companyId = document.getElementById('accessCounterCompany')?.value;\n    \n    if (!counterEmail || !companyId) {\n        showToast('Please enter counter email and select company', 'error', 3000);\n        return;\n    }\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/counter-company-access`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                counter_email: counterEmail,\n                company_id: parseInt(companyId)\n            })\n        });\n        \n        if (!response.ok) {\n            if (response.status === 409) {\n                throw new Error('This access already exists');\n            }\n            throw new Error('Failed to save access');\n        }\n        \n        showToast('Access granted successfully!', 'success', 3000);\n        closeCounterCompanyAccessModal();\n        await loadCounterCompanyAccess();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.handleCounterCompanyAccessSubmit = handleCounterCompanyAccessSubmit;\n\nasync function deleteCounterCompanyAccess(id) {\n    if (!isAdminAuthenticated()) {\n        showToast('Admin access required', 'error', 3000);\n        return;\n    }\n    \n    if (!confirm('Are you sure you want to remove this access?')) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/counter-company-access/${id}`, {\n            method: 'DELETE'\n        });\n        \n        if (!response.ok) throw new Error('Failed to delete access');\n        \n        showToast('Access removed successfully!', 'success', 3000);\n        await loadCounterCompanyAccess();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.deleteCounterCompanyAccess = deleteCounterCompanyAccess;\n\n// ========== OPEN STOCK TAKES LIST ==========\nasync function loadOpenStockTakes() {\n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/stock-takes?status=open`);\n        \n        if (!response.ok) throw new Error('Failed to load open stock takes');\n        \n        const openStockTakes = await response.json();\n        \n        const listEl = document.getElementById('openStockTakesList');\n        const noItemsEl = document.getElementById('noOpenStockTakes');\n        \n        if (listEl) {\n            if (openStockTakes.length === 0) {\n                listEl.innerHTML = '';\n                if (noItemsEl) noItemsEl.style.display = 'block';\n            } else {\n                if (noItemsEl) noItemsEl.style.display = 'none';\n                listEl.innerHTML = openStockTakes.map(st => `\n                    <div class=\"item-card\">\n                        <div class=\"item-header\">\n                            <h3>${escapeHtml(st.company_name)} - ${escapeHtml(st.warehouse_name)}</h3>\n                            <span class=\"item-id\">ID: ${st.id}</span>\n                        </div>\n                        <div class=\"item-details\">\n                            <div class=\"detail-item\"><strong>Company:</strong> ${escapeHtml(st.company_name)}</div>\n                            <div class=\"detail-item\"><strong>Warehouse:</strong> ${escapeHtml(st.warehouse_name)}</div>\n                            ${st.opened_by_name ? `<div class=\"detail-item\"><strong>Opened By:</strong> ${escapeHtml(st.opened_by_name)}</div>` : ''}\n                            <div class=\"detail-item\"><strong>Opened:</strong> ${formatDate(st.opened_at)}</div>\n                            ${st.notes ? `<div class=\"detail-item\"><strong>Notes:</strong> ${escapeHtml(st.notes)}</div>` : ''}\n                        </div>\n                        <div class=\"item-actions\">\n                            <button onclick=\"openExistingStockTake(${st.id})\" class=\"btn btn-small\">Open</button>\n                            <button onclick=\"closeStockTakeById(${st.id})\" class=\"btn btn-small btn-danger\">Close</button>\n                        </div>\n                    </div>\n                `).join('');\n            }\n        }\n    } catch (error) {\n        console.error('Error loading open stock takes:', error);\n        showToast('Error loading open stock takes: ' + error.message, 'error', 5000);\n    }\n}\nwindow.loadOpenStockTakes = loadOpenStockTakes;\n\nasync function openExistingStockTake(stockTakeId) {\n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/stock-takes/${stockTakeId}`);\n        \n        if (!response.ok) throw new Error('Failed to load stock take');\n        \n        const stockTake = await response.json();\n        currentStockTake = stockTake;\n        \n        // Set company and warehouse dropdowns\n        document.getElementById('openStockTakeCompany').value = stockTake.company_id;\n        document.getElementById('openStockTakeWarehouse').value = stockTake.warehouse_id;\n        updateWarehousesForOpenStockTake();\n        \n        updateStockTakeStatus();\n        showTab('stocktake');\n        \n        showToast('Stock take loaded successfully!', 'success', 3000);\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.openExistingStockTake = openExistingStockTake;\n\nasync function closeStockTakeById(stockTakeId) {\n    if (!confirm('Are you sure you want to close this stock take?')) return;\n    \n    try {\n        const response = await fetch(`${CONFIG.apiUrl}/stock-takes/${stockTakeId}/close`, {\n            method: 'PUT'\n        });\n        \n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Failed to close stock take');\n        }\n        \n        // If this was the current stock take, clear it\n        if (currentStockTake && currentStockTake.id === stockTakeId) {\n            currentStockTake = null;\n            currentBinLocation = null;\n            currentBinItems = [];\n            updateStockTakeStatus();\n            clearBinLocation();\n        }\n        \n        alert('‚úÖ Stock take closed successfully!');\n        loadOpenStockTakes();\n    } catch (error) {\n        showToast(error.message, 'error', 6000);\n    }\n}\nwindow.closeStockTakeById = closeStockTakeById;\n\n// ========== UTILITY FUNCTIONS ==========\nfunction formatDate(dateString) {\n    if (!dateString) return '';\n    try {\n        const date = new Date(dateString);\n        return date.toLocaleString();\n    } catch (e) {\n        return dateString;\n    }\n}\n\nfunction escapeHtml(text) {\n    if (!text) return '';\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}\n\n// ========== TOAST NOTIFICATIONS ==========\nfunction showToast(message, type = 'info', duration = 5000) {\n    const container = document.getElementById('toastContainer');\n    if (!container) return;\n    \n    const toast = document.createElement('div');\n    toast.className = `toast ${type}`;\n    \n    const icons = {\n        success: '‚úÖ',\n        error: '‚ùå',\n        warning: '‚ö†Ô∏è',\n        info: '‚ÑπÔ∏è'\n    };\n    \n    const titles = {\n        success: 'Success',\n        error: 'Error',\n        warning: 'Warning',\n        info: 'Info'\n    };\n    \n    toast.innerHTML = `\n        <div class=\"toast-icon\">${icons[type] || icons.info}</div>\n        <div class=\"toast-content\">\n            <div class=\"toast-title\">${titles[type] || 'Info'}</div>\n            <div class=\"toast-message\">${escapeHtml(message)}</div>\n        </div>\n        <button class=\"toast-close\" onclick=\"this.parentElement.remove()\">√ó</button>\n    `;\n    \n    container.appendChild(toast);\n    \n    // Auto-remove after duration\n    if (duration > 0) {\n        setTimeout(() => {\n            if (toast.parentElement) {\n                toast.style.animation = 'slideIn 0.3s ease reverse';\n                setTimeout(() => toast.remove(), 300);\n            }\n        }, duration);\n    }\n}\nwindow.showToast = showToast;\n\n// Replace alert with toast (optional - can keep some alerts for critical confirmations)\nfunction showAlert(message, type = 'info') {\n    showToast(message, type, 4000);\n}\n\n// ========== QR CODE SCANNING ==========\nasync function startQRScan(inputId) {\n    // Stop any existing scanner\n    if (qrScanner) {\n        try {\n            await qrScanner.clear();\n        } catch (e) {\n            console.log('Clearing previous scanner');\n        }\n        qrScanner = null;\n    }\n\n    // Check if Html5Qrcode is available\n    if (typeof Html5Qrcode === 'undefined') {\n        showToast('QR Code scanner library not loaded. Please refresh the page.', 'error', 5000);\n        return;\n    }\n\n    // Create modal for camera view\n    const modal = document.createElement('div');\n    modal.id = 'qrScannerModal';\n    modal.className = 'qr-scanner-modal';\n    modal.innerHTML = `\n        <div class=\"qr-scanner-content\">\n            <div class=\"qr-scanner-header\">\n                <h3>Scan QR Code</h3>\n                <button onclick=\"stopQRScan()\" class=\"btn btn-secondary\">‚úï Close</button>\n            </div>\n            <div id=\"qr-reader\" style=\"width: 100%;\"></div>\n            <p class=\"qr-hint\">Point your camera at the QR code</p>\n        </div>\n    `;\n    document.body.appendChild(modal);\n\n    // Initialize scanner\n    qrScanner = new Html5Qrcode(\"qr-reader\");\n    \n    try {\n        await qrScanner.start(\n            { facingMode: \"environment\" }, // Use back camera on mobile\n            {\n                fps: 10,\n                qrbox: { width: 250, height: 250 },\n                aspectRatio: 1.0\n            },\n            (decodedText, decodedResult) => {\n                // Successfully scanned\n                document.getElementById(inputId).value = decodedText;\n                stopQRScan();\n                \n                // Trigger the appropriate handler\n                if (inputId === 'counterBinLocationInput') {\n                    handleCounterBinLocationScan();\n                } else if (inputId === 'binLocationInput') {\n                    handleBinLocationScan();\n                } else if (inputId === 'itemCodeInput') {\n                    handleItemCodeScan();\n                }\n            },\n            (errorMessage) => {\n                // Ignore scanning errors (just keep trying)\n            }\n        );\n    } catch (err) {\n        console.error('Error starting QR scanner:', err);\n        showToast('Failed to start camera. Please check permissions and try again.', 'error', 5000);\n        stopQRScan();\n    }\n}\nwindow.startQRScan = startQRScan;\n\nasync function stopQRScan() {\n    if (qrScanner) {\n        try {\n            await qrScanner.stop();\n            await qrScanner.clear();\n        } catch (e) {\n            console.log('Stopping scanner');\n        }\n        qrScanner = null;\n    }\n    \n    const modal = document.getElementById('qrScannerModal');\n    if (modal) {\n        modal.remove();\n    }\n}\nwindow.stopQRScan = stopQRScan;\n\n// Add switch role button for counter mode\nfunction addCounterSwitchButton() {\n    // Remove existing button if any\n    const existingBtn = document.getElementById('counterSwitchRoleBtn');\n    if (existingBtn) existingBtn.remove();\n    \n    // Create switch role button\n    const switchBtn = document.createElement('button');\n    switchBtn.id = 'counterSwitchRoleBtn';\n    switchBtn.className = 'btn btn-secondary btn-small';\n    switchBtn.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 999;';\n    switchBtn.textContent = 'Switch Role';\n    switchBtn.onclick = switchRole;\n    \n    document.body.appendChild(switchBtn);\n}\n";

export const styleCss = "/* Modern App-Style Stock Take Management System */\n\n/* System Admin Button (Bottom Left) */\n.system-admin-btn {\n    position: fixed;\n    bottom: 20px;\n    left: 20px;\n    z-index: 1000;\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: 12px;\n    padding: 0.75rem 1rem;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    box-shadow: var(--shadow-md);\n    color: var(--text-primary);\n    font-size: 0.9rem;\n    font-weight: 500;\n}\n\n.system-admin-btn:hover {\n    background: var(--bg-hover);\n    border-color: var(--accent-primary);\n    transform: translateY(-2px);\n    box-shadow: var(--shadow-lg);\n}\n\n.system-admin-btn:active {\n    transform: translateY(0);\n}\n\n.system-admin-icon {\n    font-size: 1.2rem;\n}\n\n.system-admin-label {\n    font-size: 0.85rem;\n}\n\n/* Hide System Admin button when not authenticated */\nbody:not(.authenticated) .system-admin-btn {\n    display: none !important;\n}\n\n/* Show System Admin button when authenticated */\nbody.authenticated .system-admin-btn {\n    display: flex !important;\n}\n\n:root {\n    --bg-primary: #0a0a0f;\n    --bg-secondary: #121218;\n    --bg-tertiary: #1a1a24;\n    --bg-card: #1e1e2e;\n    --bg-input: #252538;\n    --bg-hover: #2a2a40;\n    --bg-sidebar: #151520;\n    --bg-nav-active: #6366f1;\n    \n    --text-primary: #ffffff;\n    --text-secondary: #b4b4c4;\n    --text-muted: #6b6b7a;\n    \n    --accent-primary: #6366f1;\n    --accent-secondary: #8b5cf6;\n    --accent-success: #10b981;\n    --accent-danger: #ef4444;\n    --accent-warning: #f59e0b;\n    \n    --border-color: #2a2a3a;\n    --border-hover: #3a3a4a;\n    \n    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);\n    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);\n    --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);\n    \n    --radius-sm: 8px;\n    --radius-md: 12px;\n    --radius-lg: 16px;\n    \n    --sidebar-width: 260px;\n    --header-height: 64px;\n}\n\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'Roboto', sans-serif;\n    background: var(--bg-primary);\n    color: var(--text-primary);\n    min-height: 100vh;\n    line-height: 1.6;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    overflow-x: hidden;\n}\n\n/* App Layout */\n.app-container {\n    display: flex;\n    min-height: 100vh;\n    background: var(--bg-primary);\n}\n\n/* Sidebar Navigation */\n.sidebar {\n    width: var(--sidebar-width);\n    background: var(--bg-sidebar);\n    border-right: 1px solid var(--border-color);\n    position: fixed;\n    left: 0;\n    top: 0;\n    height: 100vh;\n    overflow-y: auto;\n    z-index: 1000;\n    transition: transform 0.3s ease;\n}\n\n.sidebar-header {\n    padding: 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n\n.sidebar-logo {\n    font-size: 1.5rem;\n    font-weight: 700;\n    color: var(--text-primary);\n    letter-spacing: -0.5px;\n}\n\n.sidebar-nav {\n    padding: 1rem 0;\n}\n\n.nav-item {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    padding: 0.875rem 1.5rem;\n    color: var(--text-secondary);\n    text-decoration: none;\n    transition: all 0.2s ease;\n    cursor: pointer;\n    border-left: 3px solid transparent;\n    font-size: 0.95rem;\n    font-weight: 500;\n}\n\n.nav-item:hover {\n    background: var(--bg-tertiary);\n    color: var(--text-primary);\n    border-left-color: var(--accent-primary);\n}\n\n.nav-item.active {\n    background: rgba(99, 102, 241, 0.1);\n    color: var(--accent-primary);\n    border-left-color: var(--accent-primary);\n}\n\n.nav-icon {\n    width: 20px;\n    height: 20px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.1rem;\n}\n\n.nav-label {\n    flex: 1;\n}\n\n/* Main Content Area */\n.main-content {\n    flex: 1;\n    margin-left: var(--sidebar-width);\n    min-height: 100vh;\n    display: flex;\n    flex-direction: column;\n    transition: margin-left 0.3s ease;\n}\n\n.main-content.full-width {\n    margin-left: 0;\n}\n\n/* App Header */\n.app-header {\n    height: var(--header-height);\n    background: var(--bg-card);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0 2rem;\n    position: sticky;\n    top: 0;\n    z-index: 100;\n    backdrop-filter: blur(10px);\n}\n\n.header-title {\n    font-size: 1.25rem;\n    font-weight: 600;\n    color: var(--text-primary);\n}\n\n.header-actions {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    flex-wrap: wrap;\n}\n\n.user-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n\n.user-display {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    gap: 0.25rem;\n}\n\n.user-name {\n    font-size: 0.875rem;\n    font-weight: 500;\n    color: var(--text-primary);\n}\n\n.user-email {\n    font-size: 0.75rem;\n    color: var(--text-muted);\n}\n\n.role-badge {\n    padding: 0.375rem 0.75rem;\n    background: var(--bg-tertiary);\n    border: 1px solid var(--border-color);\n    border-radius: var(--radius-sm);\n    font-size: 0.875rem;\n    color: var(--text-secondary);\n    text-transform: capitalize;\n}\n\n.role-badge.counter {\n    border-color: var(--accent-success);\n    color: var(--accent-success);\n}\n\n.role-badge.manager {\n    border-color: var(--accent-primary);\n    color: var(--accent-primary);\n}\n\n.btn-switch-role {\n    padding: 0.5rem 1rem;\n    background: var(--bg-tertiary);\n    border: 1px solid var(--border-color);\n    border-radius: var(--radius-sm);\n    color: var(--text-primary);\n    font-size: 0.875rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.btn-switch-role:hover {\n    background: var(--bg-hover);\n    border-color: var(--border-hover);\n}\n\n/* Content Area */\n.content-area {\n    flex: 1;\n    padding: 2rem;\n    overflow-y: auto;\n}\n\n/* Role Selection Screen */\n.role-selection-screen {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 100vh;\n    padding: 2rem;\n    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);\n}\n\n.role-selection-card {\n    background: var(--bg-card);\n    border-radius: var(--radius-lg);\n    padding: 3rem;\n    box-shadow: var(--shadow-lg);\n    max-width: 800px;\n    width: 100%;\n    text-align: center;\n    border: 1px solid var(--border-color);\n}\n\n.role-selection-card h1 {\n    font-size: 2rem;\n    color: var(--text-primary);\n    margin-bottom: 0.5rem;\n    font-weight: 700;\n    letter-spacing: -0.5px;\n}\n\n.role-selection-card .subtitle {\n    color: var(--text-secondary);\n    font-size: 1rem;\n    margin-bottom: 3rem;\n}\n\n.role-options {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 1.5rem;\n    margin-top: 2rem;\n}\n\n.role-option-btn {\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: var(--radius-md);\n    padding: 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-align: center;\n    position: relative;\n    overflow: hidden;\n}\n\n.role-option-btn::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 3px;\n    background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));\n    transform: scaleX(0);\n    transition: transform 0.3s ease;\n}\n\n.role-option-btn:hover {\n    transform: translateY(-2px);\n    border-color: var(--accent-primary);\n    box-shadow: var(--shadow-md);\n    background: var(--bg-tertiary);\n}\n\n.role-option-btn:hover::before {\n    transform: scaleX(1);\n}\n\n.role-option-btn.counter-btn:hover {\n    border-color: var(--accent-success);\n}\n\n.role-option-btn.counter-btn:hover::before {\n    background: linear-gradient(90deg, var(--accent-success), #34d399);\n}\n\n.role-option-btn.manager-btn:hover {\n    border-color: var(--accent-primary);\n}\n\n.role-icon {\n    font-size: 3rem;\n    margin-bottom: 1rem;\n    pointer-events: none;\n    filter: grayscale(0.3);\n    transition: filter 0.3s ease;\n}\n\n.role-option-btn:hover .role-icon {\n    filter: grayscale(0);\n}\n\n.role-option-btn h2 {\n    color: var(--text-primary);\n    margin-bottom: 0.5rem;\n    font-size: 1.25rem;\n    font-weight: 600;\n    pointer-events: none;\n}\n\n.role-option-btn p {\n    color: var(--text-secondary);\n    font-size: 0.9rem;\n    pointer-events: none;\n}\n\n/* Page Content */\n.page-content {\n    max-width: 1200px;\n    margin: 0 auto;\n    width: 100%;\n}\n\n.page-header {\n    margin-bottom: 2rem;\n}\n\n.page-title {\n    font-size: 2rem;\n    font-weight: 700;\n    color: var(--text-primary);\n    margin-bottom: 0.5rem;\n    letter-spacing: -0.5px;\n}\n\n.page-subtitle {\n    color: var(--text-secondary);\n    font-size: 1rem;\n}\n\n/* Cards */\n.card {\n    background: var(--bg-card);\n    border-radius: var(--radius-md);\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid var(--border-color);\n    transition: all 0.2s ease;\n}\n\n.card:hover {\n    border-color: var(--border-hover);\n    box-shadow: var(--shadow-sm);\n}\n\n.card-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n.card-title {\n    font-size: 1.25rem;\n    font-weight: 600;\n    color: var(--text-primary);\n}\n\n/* Forms */\n.form-group {\n    margin-bottom: 1.5rem;\n}\n\n.form-group label {\n    display: block;\n    color: var(--text-primary);\n    margin-bottom: 0.5rem;\n    font-weight: 500;\n    font-size: 0.9rem;\n}\n\n.form-control {\n    width: 100%;\n    padding: 0.75rem 1rem;\n    background: var(--bg-input);\n    border: 1px solid var(--border-color);\n    border-radius: var(--radius-sm);\n    color: var(--text-primary);\n    font-size: 1rem;\n    transition: all 0.2s ease;\n    font-family: inherit;\n}\n\n.form-control:focus {\n    outline: none;\n    border-color: var(--accent-primary);\n    background: var(--bg-tertiary);\n    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);\n}\n\n.form-control::placeholder {\n    color: var(--text-muted);\n}\n\n.form-row {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 1.5rem;\n}\n\n/* Buttons */\n.btn {\n    padding: 0.75rem 1.5rem;\n    border: none;\n    border-radius: var(--radius-sm);\n    font-size: 0.95rem;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5rem;\n    font-family: inherit;\n}\n\n.btn-primary {\n    background: var(--accent-primary);\n    color: white;\n}\n\n.btn-primary:hover {\n    background: #4f46e5;\n    transform: translateY(-1px);\n    box-shadow: var(--shadow-sm);\n}\n\n.btn-secondary {\n    background: var(--bg-tertiary);\n    color: var(--text-primary);\n    border: 1px solid var(--border-color);\n}\n\n.btn-secondary:hover {\n    background: var(--bg-hover);\n    border-color: var(--border-hover);\n}\n\n.btn-danger {\n    background: var(--accent-danger);\n    color: white;\n}\n\n.btn-danger:hover {\n    background: #dc2626;\n}\n\n.btn-success {\n    background: var(--accent-success);\n    color: white;\n}\n\n.btn-success:hover {\n    background: #059669;\n}\n\n.btn-small {\n    padding: 0.5rem 1rem;\n    font-size: 0.875rem;\n}\n\n.btn-tiny {\n    padding: 0.375rem 0.75rem;\n    font-size: 0.8rem;\n    line-height: 1.2;\n}\n\n.btn-large {\n    padding: 1rem 2rem;\n    font-size: 1.05rem;\n}\n\n.btn-link {\n    background: none;\n    color: var(--accent-primary);\n    text-decoration: none;\n    padding: 0.5rem;\n    border: none;\n    cursor: pointer;\n}\n\n.btn-link:hover {\n    color: var(--accent-secondary);\n    text-decoration: underline;\n}\n\n/* Status Box */\n.status-box {\n    background: var(--bg-secondary);\n    border: 1px solid var(--border-color);\n    border-radius: var(--radius-sm);\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.status-box.success {\n    background: rgba(16, 185, 129, 0.1);\n    border-color: var(--accent-success);\n    color: var(--accent-success);\n}\n\n.status-box p {\n    margin: 0.5rem 0;\n    color: var(--text-secondary);\n}\n\n.status-box.success p {\n    color: var(--accent-success);\n}\n\n/* Scanning Sections */\n.scanning-section {\n    margin-top: 1.5rem;\n}\n\n.scan-input-large {\n    margin-bottom: 1.5rem;\n}\n\n.scan-label {\n    display: block;\n    color: var(--text-primary);\n    font-weight: 500;\n    margin-bottom: 0.5rem;\n    font-size: 1rem;\n}\n\n.scan-hint {\n    color: var(--text-muted);\n    font-size: 0.85rem;\n    margin-bottom: 0.75rem;\n}\n\n.scan-input {\n    font-size: 1.1rem;\n    padding: 1rem;\n}\n\n.input-with-button-large {\n    display: flex;\n    gap: 0.75rem;\n    align-items: stretch;\n}\n\n.input-with-button-large .scan-input {\n    flex: 1;\n}\n\n.current-bin-box {\n    background: rgba(16, 185, 129, 0.1);\n    border: 1px solid var(--accent-success);\n    border-radius: var(--radius-sm);\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.current-bin-box h3 {\n    color: var(--accent-success);\n    margin-bottom: 0.5rem;\n    font-size: 1.1rem;\n    font-weight: 600;\n}\n\n.current-bin-box p {\n    color: var(--text-secondary);\n    margin: 0;\n    font-size: 0.9rem;\n}\n\n/* Items List */\n.items-list {\n    display: grid;\n    gap: 1rem;\n}\n\n.item-card {\n    background: var(--bg-card);\n    border: 1px solid var(--border-color);\n    border-radius: var(--radius-sm);\n    padding: 1.5rem;\n    transition: all 0.2s ease;\n}\n\n.item-card:hover {\n    border-color: var(--border-hover);\n    box-shadow: var(--shadow-sm);\n}\n\n.item-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1rem;\n}\n\n.item-header h3 {\n    color: var(--text-primary);\n    font-size: 1.1rem;\n    font-weight: 600;\n}\n\n.item-id {\n    color: var(--text-muted);\n    font-size: 0.85rem;\n}\n\n.item-details {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1rem;\n    margin-bottom: 1rem;\n}\n\n.detail-item {\n    color: var(--text-secondary);\n    font-size: 0.9rem;\n}\n\n.detail-item strong {\n    color: var(--text-primary);\n}\n\n.item-actions {\n    display: flex;\n    gap: 0.75rem;\n    flex-wrap: wrap;\n}\n\n/* Toast Notifications */\n.toast-container {\n    position: fixed;\n    top: 2rem;\n    right: 2rem;\n    z-index: 10000;\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    max-width: 400px;\n}\n\n.toast {\n    background: var(--bg-card);\n    border: 1px solid var(--border-color);\n    border-radius: var(--radius-sm);\n    padding: 1rem 1.5rem;\n    box-shadow: var(--shadow-lg);\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    animation: slideIn 0.3s ease;\n    border-left: 4px solid var(--accent-primary);\n}\n\n.toast.success {\n    border-left-color: var(--accent-success);\n}\n\n.toast.error {\n    border-left-color: var(--accent-danger);\n}\n\n.toast.warning {\n    border-left-color: var(--accent-warning);\n}\n\n.toast-icon {\n    font-size: 1.25rem;\n}\n\n.toast-content {\n    flex: 1;\n}\n\n.toast-title {\n    font-weight: 600;\n    color: var(--text-primary);\n    margin-bottom: 0.25rem;\n    font-size: 0.9rem;\n}\n\n.toast-message {\n    color: var(--text-secondary);\n    font-size: 0.85rem;\n}\n\n.toast-close {\n    background: none;\n    border: none;\n    color: var(--text-muted);\n    cursor: pointer;\n    font-size: 1.2rem;\n    padding: 0;\n    width: 24px;\n    height: 24px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n    transition: all 0.2s ease;\n}\n\n.toast-close:hover {\n    background: var(--bg-hover);\n    color: var(--text-primary);\n}\n\n@keyframes slideIn {\n    from {\n        transform: translateX(100%);\n        opacity: 0;\n    }\n    to {\n        transform: translateX(0);\n        opacity: 1;\n    }\n}\n\n/* Button Groups */\n.button-group {\n    display: flex;\n    gap: 1rem;\n    flex-wrap: wrap;\n    margin-top: 1.5rem;\n}\n\n.button-group-center {\n    display: flex;\n    justify-content: center;\n    gap: 1rem;\n    margin-top: 1.5rem;\n}\n\n/* No Items */\n.no-items {\n    text-align: center;\n    padding: 3rem;\n    color: var(--text-muted);\n    font-size: 1rem;\n}\n\n/* Validation Messages */\n.validation-message {\n    padding: 1rem;\n    border-radius: var(--radius-sm);\n    margin-top: 1rem;\n    font-size: 0.9rem;\n}\n\n.validation-message.error {\n    background: rgba(239, 68, 68, 0.1);\n    border: 1px solid var(--accent-danger);\n    color: var(--accent-danger);\n}\n\n.validation-message.success {\n    background: rgba(16, 185, 129, 0.1);\n    border: 1px solid var(--accent-success);\n    color: var(--accent-success);\n}\n\n/* Modals */\n.modal {\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.75);\n    z-index: 1000;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(4px);\n}\n\n.modal.active {\n    display: flex;\n}\n\n.modal-content {\n    background: var(--bg-card);\n    border-radius: var(--radius-lg);\n    padding: 2rem;\n    max-width: 600px;\n    width: 90%;\n    max-height: 90vh;\n    overflow-y: auto;\n    box-shadow: var(--shadow-lg);\n    border: 1px solid var(--border-color);\n    animation: modalSlideIn 0.3s ease;\n}\n\n@keyframes modalSlideIn {\n    from {\n        transform: scale(0.95);\n        opacity: 0;\n    }\n    to {\n        transform: scale(1);\n        opacity: 1;\n    }\n}\n\n.modal-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n}\n\n.modal-header h3 {\n    color: var(--text-primary);\n    font-size: 1.5rem;\n    font-weight: 600;\n}\n\n.modal-close {\n    background: none;\n    border: none;\n    color: var(--text-muted);\n    font-size: 1.5rem;\n    cursor: pointer;\n    padding: 0.5rem;\n    border-radius: var(--radius-sm);\n    transition: all 0.2s ease;\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.modal-close:hover {\n    background: var(--bg-hover);\n    color: var(--text-primary);\n}\n\n.modal-actions {\n    display: flex;\n    gap: 1rem;\n    justify-content: flex-end;\n    margin-top: 2rem;\n    padding-top: 1.5rem;\n    border-top: 1px solid var(--border-color);\n}\n\n/* QR Scanner Modal */\n.qr-scanner-modal {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.95);\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.qr-scanner-content {\n    background: var(--bg-card);\n    border-radius: var(--radius-lg);\n    padding: 2rem;\n    max-width: 90%;\n    max-height: 90%;\n    width: 500px;\n    text-align: center;\n    border: 1px solid var(--border-color);\n}\n\n.qr-scanner-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n}\n\n.qr-scanner-header h3 {\n    margin: 0;\n    color: var(--text-primary);\n}\n\n#qr-reader {\n    margin: 1rem 0;\n    border-radius: var(--radius-sm);\n    overflow: hidden;\n}\n\n.qr-hint {\n    color: var(--text-secondary);\n    font-size: 0.9rem;\n    margin-top: 1rem;\n}\n\n\n/* Responsive */\n@media (max-width: 1024px) {\n    .sidebar {\n        transform: translateX(-100%);\n    }\n    \n    .sidebar.open {\n        transform: translateX(0);\n    }\n    \n    .main-content {\n        margin-left: 0;\n    }\n    \n}\n\n@media (max-width: 768px) {\n    .content-area {\n        padding: 1rem;\n    }\n    \n    .app-header {\n        padding: 0 1rem;\n    }\n    \n    .form-row {\n        grid-template-columns: 1fr;\n    }\n    \n    .item-details {\n        grid-template-columns: 1fr;\n    }\n    \n    .item-actions {\n        flex-direction: column;\n    }\n    \n    .toast-container {\n        left: 1rem;\n        right: 1rem;\n        max-width: none;\n    }\n    \n    .page-title {\n        font-size: 1.5rem;\n    }\n}\n\n/* View Items Page */\n.view-items-page {\n    width: 100%;\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n.view-items-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    margin-bottom: 2rem;\n    flex-wrap: wrap;\n    gap: 1rem;\n}\n\n.view-items-filters {\n    background: var(--bg-card);\n    border: 1px solid var(--border-color);\n    border-radius: var(--radius-md);\n    padding: 1.5rem;\n    margin-bottom: 2rem;\n}\n\n.view-items-content {\n    min-height: 400px;\n}\n\n.view-items-list {\n    width: 100%;\n    overflow-x: auto;\n    -webkit-overflow-scrolling: touch;\n}\n\n.view-items-list::-webkit-scrollbar {\n    height: 8px;\n}\n\n.view-items-list::-webkit-scrollbar-track {\n    background: var(--bg-secondary);\n    border-radius: 4px;\n}\n\n.view-items-list::-webkit-scrollbar-thumb {\n    background: var(--border-color);\n    border-radius: 4px;\n}\n\n.view-items-list::-webkit-scrollbar-thumb:hover {\n    background: var(--border-hover);\n}\n\n/* Setup Sub-Navigation */\n.setup-nav {\n    display: flex;\n    gap: 0.5rem;\n    margin-bottom: 2rem;\n    padding-bottom: 1rem;\n    border-bottom: 2px solid var(--border-color);\n}\n\n.setup-nav-item {\n    padding: 0.75rem 1.5rem;\n    background: transparent;\n    border: none;\n    border-bottom: 2px solid transparent;\n    color: var(--text-secondary);\n    font-size: 0.95rem;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    margin-bottom: -1rem;\n}\n\n.setup-nav-item:hover {\n    color: var(--text-primary);\n}\n\n.setup-nav-item.active {\n    color: var(--accent-primary);\n    border-bottom-color: var(--accent-primary);\n}\n\n.setup-nav-label {\n    font-weight: 500;\n}\n\n/* Setup Pages */\n.setup-page {\n    display: none !important;\n}\n\n.setup-page.active {\n    display: block !important;\n}\n\n/* Responsive table for mobile */\n@media (max-width: 768px) {\n    .view-items-table {\n        font-size: 0.85rem;\n    }\n    \n    .view-items-table th,\n    .view-items-table td {\n        padding: 0.625rem 0.75rem;\n    }\n    \n    .view-items-table th:first-child,\n    .view-items-table td:first-child {\n        padding-left: 1rem;\n    }\n    \n    .view-items-table th:last-child,\n    .view-items-table td:last-child {\n        padding-right: 1rem;\n    }\n    \n    .view-item-name-cell {\n        min-width: 150px;\n        max-width: 200px;\n    }\n    \n    .view-item-company-cell,\n    .view-item-warehouse-cell {\n        min-width: 120px;\n    }\n    \n    .view-item-actions-cell {\n        min-width: 120px;\n    }\n    \n    .btn-tiny {\n        padding: 0.25rem 0.5rem;\n        font-size: 0.75rem;\n    }\n}\n\n/* View Items Table List */\n.view-items-table {\n    width: 100%;\n    border-collapse: collapse;\n    background: var(--bg-card);\n    border: 1px solid var(--border-color);\n    border-radius: var(--radius-md);\n    overflow: hidden;\n}\n\n.view-items-table thead {\n    background: var(--bg-secondary);\n    border-bottom: 2px solid var(--border-color);\n}\n\n.view-items-table th {\n    padding: 0.75rem 1rem;\n    text-align: left;\n    font-weight: 600;\n    font-size: 0.875rem;\n    color: var(--text-secondary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    white-space: nowrap;\n}\n\n.view-items-table th:first-child {\n    padding-left: 1.5rem;\n}\n\n.view-items-table th:last-child {\n    padding-right: 1.5rem;\n}\n\n.view-item-row {\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.15s ease;\n}\n\n.view-item-row:hover {\n    background: var(--bg-hover);\n}\n\n.view-item-row:last-child {\n    border-bottom: none;\n}\n\n.view-items-table td {\n    padding: 0.875rem 1rem;\n    font-size: 0.9rem;\n    color: var(--text-primary);\n    vertical-align: middle;\n}\n\n.view-items-table td:first-child {\n    padding-left: 1.5rem;\n}\n\n.view-items-table td:last-child {\n    padding-right: 1.5rem;\n}\n\n.view-item-name-cell {\n    min-width: 200px;\n    max-width: 300px;\n}\n\n.item-name-text {\n    font-weight: 600;\n    color: var(--text-primary);\n    margin-bottom: 0.25rem;\n}\n\n.item-notes-text {\n    font-size: 0.8rem;\n    color: var(--text-muted);\n    font-style: italic;\n    margin-top: 0.25rem;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.view-item-code-cell {\n    font-family: 'Courier New', monospace;\n    color: var(--text-secondary);\n    min-width: 120px;\n}\n\n.view-item-quantity-cell {\n    text-align: center;\n    min-width: 80px;\n}\n\n.quantity-badge {\n    display: inline-block;\n    background: var(--bg-secondary);\n    color: var(--accent-primary);\n    font-weight: 700;\n    font-size: 1rem;\n    padding: 0.375rem 0.75rem;\n    border-radius: var(--radius-sm);\n    border: 1px solid var(--border-color);\n}\n\n.view-item-company-cell,\n.view-item-warehouse-cell {\n    min-width: 150px;\n    color: var(--text-secondary);\n}\n\n.view-item-bin-cell {\n    font-family: 'Courier New', monospace;\n    color: var(--text-secondary);\n    min-width: 100px;\n}\n\n.view-item-date-cell {\n    color: var(--text-muted);\n    font-size: 0.85rem;\n    min-width: 120px;\n    white-space: nowrap;\n}\n\n.view-item-actions-cell {\n    white-space: nowrap;\n    min-width: 140px;\n}\n\n.view-item-actions-cell .btn {\n    margin-right: 0.5rem;\n}\n\n.view-item-actions-cell .btn:last-child {\n    margin-right: 0;\n}\n\n.view-item-detail-row {\n    display: flex;\n    justify-content: space-between;\n    padding: 0.5rem 0;\n    border-bottom: 1px solid var(--border-color);\n}\n\n.view-item-detail-row:last-child {\n    border-bottom: none;\n}\n\n.detail-label {\n    font-size: 0.875rem;\n    color: var(--text-secondary);\n    font-weight: 500;\n}\n\n.detail-value {\n    font-size: 0.875rem;\n    color: var(--text-primary);\n    text-align: right;\n    flex: 1;\n    margin-left: 1rem;\n}\n\n.view-item-actions {\n    display: flex;\n    gap: 0.75rem;\n    padding-top: 1rem;\n    border-top: 1px solid var(--border-color);\n}\n\n.loading-state {\n    text-align: center;\n    padding: 3rem;\n    color: var(--text-secondary);\n}\n\n.error-message {\n    text-align: center;\n    padding: 2rem;\n    color: var(--accent-danger);\n    background: rgba(239, 68, 68, 0.1);\n    border: 1px solid var(--accent-danger);\n    border-radius: var(--radius-sm);\n}\n\n/* Scrollbar */\n::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n}\n\n::-webkit-scrollbar-track {\n    background: var(--bg-secondary);\n}\n\n::-webkit-scrollbar-thumb {\n    background: var(--bg-tertiary);\n    border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: var(--bg-hover);\n}\n";
